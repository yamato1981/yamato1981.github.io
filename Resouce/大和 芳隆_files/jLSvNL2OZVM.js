if (self.CavalryLogger) { CavalryLogger.start_js(["Lrklz"]); }

__d("IrisProtocolMessageLifetime",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:30000,TTL_1MINUTE:60000,TTL_3MINUTES:180000,TTL_5MINUTES:300000,TTL_10MINUTES:600000,TTL_15MINUTES:900000,TTL_30MINUTES:1800000,TTL_1HOUR:3600000,TTL_2HOURS:7200000,TTL_4HOURS:14400000,TTL_8HOURS:28800000,TTL_12HOURS:43200000,TTL_24HOURS:86400000};}),null);
__d("MercurySyncTopicType",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DELTA:"delta",DELTAFLOW:"deltaflow"};}),null);
__d("MessagingEvent",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={DELETE:"delete",DELETE_MESSAGES:"delete_messages",DELIVER:"deliver",ERROR:"error",READ:"read",REPORT_SPAM:"report_spam",REPORT_SPAM_MESSAGES:"report_spam_messages",UNMARK_SPAM:"unmark_spam",SUBSCRIBE:"subscribe",CHANGE_MUTE_SETTINGS:"change_mute_settings",TAG:"tag",UNREAD:"unread",UNSUBSCRIBE:"unsubscribe",DELIVER_LOG:"deliver_log",MORE_THREADS:"more_threads",READ_ALL:"read_all",READ_RECEIPT:"read_receipt",DELIVERY_RECEIPT:"delivery_receipt",SENT_PUSH:"sent_push",DELIVER_FAST_PAST:"deliver_fast_path",MESSENGER_STATUS:"messenger_status",UPDATE_PINNED_THREADS:"update_pinned_threads",CHANGE_PAGE_THREAD_FLAG:"change_page_thread_flag",CREATE_PAGE_ADMIN_NOTE:"create_page_admin_note",NO_OP:"no_op"};}),null);
__d("MessagingThreadAction",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ACTION_INVALID:"ACTION_INVALID",ACTION_ARCHIVED:"ACTION_ARCHIVED",ACTION_UNARCHIVED:"ACTION_UNARCHIVED"};}),null);
__d("MessengerApprovalQueueTypes",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={REQUESTED:"REQUESTED",REMOVED:"REMOVED"};}),null);
__d("OmniMActionType",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CREATE_EVENT:1,LOCATION:2,PAYMENT:3,POLL:4,STICKER:5,TEXT:6,TRANSPORTATION:7,ORDER_FOOD:8,MAKE_RESERVATION:9,SCHEDULE_CALL:10,LIVE_LOCATION:11};}),null);
__d("OmniMDirectiveType",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ADD_ACTIONS:1,CLEAR_ACTIONS:2,ADD_RANGES:3,INVOKE_NATIVE_AGENT:4,MUTATE_FLOW_STATE:5};}),null);
__d("OmniMLoggerEvents",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MESSAGE_ANALYZED:"omni_m_message_analyzed",INTENT_DETECTED:"omni_m_intent_detected",INTENT_HANDLED:"omni_m_intent_handled",SUGGESTION_GENERATED:"omni_m_suggestion_generated",SUGGESTION_DISPLAYED:"omni_m_suggestion_displayed",SUGGESTION_CLICKED:"omni_m_suggestion_clicked",SUGGESTION_COMPLETED:"omni_m_suggestion_completed",SUGGESTION_DISMISSED:"omni_m_suggestion_dismissed",SUGGESTION_DISAPPEARED:"omni_m_suggestion_disappeared",BAR_DISMISSED:"omni_m_bar_dismissed",BAR_DISPLAYED:"omni_m_bar_displayed",BAR_DISAPPEARED:"omni_m_bar_disappeared"};}),null);
__d("OzConstants",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={AUTHOR_TYPES:{BOT:"bot",TRAINER:"trainer",USER:"user"},ATTS:{COMMAND:"\u0040COMMAND",IMAGE:"image",SUGG:"\u0040SUGG",TEMPLATE:"template",SURVEY:"survey",QUICK_REPLIES:"\u0040QUICK_REPLIES",OPENTABLEQR:"opentableQuickReply"},SESSION_INFO_EVENT:"iframenonce_fb_session_info",TOKENS:{USER_FIRST_NAME:"user-first-name"},REMINDERS:{RANGE_IN_YEARS:5},M_FBIDS:{M:"881263441913087",M_DEV:"1579802578966277",P:"506060876211905"}};}),null);
__d("PagesMessagingEventType",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={FLAG:1,CREATE_ADMIN_NOTE:2,PRIORITY_UPDATE:3};}),null);
__d('ChatWelcomeMessage',['ImmutableObject'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.$ChatWelcomeMessage1={};}h.prototype.setWelcomeMessage=function(j,k,l){this.$ChatWelcomeMessage1[j]=new (c('ImmutableObject'))({timestamp:Date.now(),thread_id:j,author:k,body:l});};h.prototype.getWelcomeMessage=function(j){return this.$ChatWelcomeMessage1[j];};var i=new h();f.exports=i;}),null);
__d('ChatOpenTabImpl',['Promise','Arbiter','Bootloader','ChatApp','ChatOpenTab','ChatOpenTabEventLogger','ChatWelcomeMessage','MercuryEmployeeDualityPreferences','LogHistory','MercuryIDs','MercuryParticipants','MercuryViewer','MercuryThreadActions','MercuryThreadIDMap','MercuryThreads','WorkFocusModeController','WorkModeConfig','WorkDualityDismissWarning','requireWeak'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadActions').get(),i=c('MercuryThreadIDMap').get(),j=c('MercuryThreads').get(),k=c('WorkFocusModeController').WorkFocusMode,l=null;c('requireWeak')('ChatTabModel',function(n){return l=n;});var m={canOpenTab:function n(){return !!(c('ChatApp')&&!c('ChatApp').isHidden());},openEmptyTab:function n(o,p,q){if(this.canOpenTab()&&l){var r=l.getEmptyTab();this._openClientTab(r,null);this._logChatOpenTabEvent(p,r,null,q);this._closeJewelFlyout();}},openThreadTab:function n(o,p,q,r,s){if(!c('MercuryIDs').isValid(o)){i.getClientIDFromServerID(o,function(t){m.openThreadTabImpl(t,p,q,r,s);});}else m.openThreadTabImpl(o,p,q,r,s);},openThreadTabImpl:function n(o,p,q,r,s){k&&k.addBypassFocusModeForThread(o);var t=new (c('Promise'))(function(v,w){j.getThreadMeta(o,function(x){v(x);});}),u=new (c('Promise'))(function(v,w){c('Bootloader').loadModules(["MercuryBlockedParticipants","GroupChatMessageBlockAlert"],function(x,y){v({MercuryBlockedParticipants:x.get(),GroupChatMessageBlockAlert:y});},'ChatOpenTabImpl');});c('Promise').all([u,t]).then(this._whenThreadLoaded.bind(this,o,p,q,r,s),this._whenThreadNotLoaded.bind(this,{thread_id:o})).done();},_whenThreadLoaded:function n(o,p,q,r,s,t){var u=t[0],v=u.MercuryBlockedParticipants,w=u.GroupChatMessageBlockAlert,x=t[1];if(v.isPresentInGroupThread(x)){w.show(v.inGroupThread(x),function(){this.openClientTab(o,p,q,r,s);}.bind(this),function(){h.leaveGroup(o);});}else this.openClientTab(o,p,q,r,s);},_whenThreadNotLoaded:function n(o,p){c('LogHistory').getInstance('mercury').error('Unable to load modules and/or get thread meta',p);},openClientTab:function n(o,p,q,r,s){this._openClientTab(o,r,s);this._logChatOpenTabEvent(p,o,null,q);this._closeJewelFlyout();},openUserTab:function n(o,p,q){var r=c('MercuryIDs').getThreadIDFromUserID(o);this._openClientTab(r);this._logChatOpenTabEvent(p,r,o,q);},openPageTab:function n(o,p,q){var r=c('MercuryIDs').getThreadIDFromUserID(p);j.getThreadMeta(r,function(s){if(o&&o.length>0){var t=(Date.now()-s.timestamp)/1000,u=t/3600;if(s.message_count===0||u>24)c('ChatWelcomeMessage').setWelcomeMessage(r,c('MercuryIDs').getParticipantIDFromUserID(p),o);}});this._openClientTab(r);this._logChatOpenTabEvent(q,r,p);},_closeJewelFlyout:function n(){c('Arbiter').inform('jewel/hide');},_openClientTab:function n(o,p,q){j.getThreadMeta(o,function(r){if(!this.canOpenTab())c('LogHistory').getInstance('mercury').error('Unable to open chat tab',o);k&&k.addBypassFocusModeForThread(o);var s=c('WorkModeConfig').has_work_user;if(s||!c('MercuryEmployeeDualityPreferences').duality_warning_gk_check){c('ChatApp').tabController.openTab(o,c('ChatApp').tabsViewport,p,!!q);}else c('MercuryParticipants').get(c('MercuryViewer').getID(),function(t){var u,v=t.employee;if(!v){c('ChatApp').tabController.openTab(o,c('ChatApp').tabsViewport,p,!!q);}else (function(){var w=c('MercuryIDs').getUserIDFromThreadID(r.thread_id);c('MercuryParticipants').getMulti(r.participants,function(x){var y=false,z=o;for(var aa in x)if(x[aa].personal_id&&w===x[aa].personal_id&&x[aa].work_id&&x[aa].employee&&!x[aa].is_friend&&!c('WorkDualityDismissWarning').isWarningAcknowledged(z)){o=c('MercuryIDs').getThreadIDFromUserID(x[aa].work_id);c('WorkDualityDismissWarning').setHijackedThread(o);y=true;break;}if(y){c('ChatOpenTab').openThread(o);}else c('ChatApp').tabController.openTab(o,c('ChatApp').tabsViewport,p,!!q);});})();});}.bind(this));},_logChatOpenTabEvent:function n(o,p,q,r){c('ChatOpenTabEventLogger').log(o,p,q,r);}};f.exports=m;}),null);
__d('ChatAppActionTypes',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=c('keyMirror')({INITIAL_DISPLAY_DONE:null,HIDE:null,LOAD:null,TTI:null,UNHIDE:null});}),null);
__d('ChatAppActions',['ChatDispatcher','ChatAppActionTypes'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={tti:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').TTI});},hide:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').HIDE});},unhide:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').UNHIDE});},setInitialDisplayDone:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').INITIAL_DISPLAY_DONE});},load:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').LOAD});}};f.exports=h;}),null);
__d('ChatAppStore',['ChatAppActionTypes','ChatDispatcher','FluxStore'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('ChatDispatcher'));this.$ChatAppStore2={initialDisplayDone:false,isHidden:false,isInitialized:false,isLoaded:false};this.$ChatAppStore1=babelHelpers['extends']({},this.$ChatAppStore2);}j.prototype.__onDispatch=function(k){var l=k.type;this.$ChatAppStore1=babelHelpers['extends']({},this.$ChatAppStore2);switch(l){case c('ChatAppActionTypes').INITIAL_DISPLAY_DONE:this.$ChatAppStore2.initialDisplayDone=true;this.__emitChange();break;case c('ChatAppActionTypes').HIDE:this.$ChatAppStore2.isHidden=true;this.__emitChange();break;case c('ChatAppActionTypes').UNHIDE:this.$ChatAppStore2.isHidden=false;this.__emitChange();break;case c('ChatAppActionTypes').TTI:this.$ChatAppStore2.isInitialized=this.$ChatAppStore2.isLoaded=true;this.__emitChange();break;case c('ChatAppActionTypes').LOAD:this.$ChatAppStore2.isLoaded=true;this.__emitChange();break;}};j.prototype.getPreviousState=function(){return this.$ChatAppStore1;};j.prototype.getState=function(){return this.$ChatAppStore2;};f.exports=new j();}),null);
__d('ChatMentionsNotifications',['fbt','CurrentUser','MercuryParticipants'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={notifyIfMessageToMe:function j(k){var l='fbid:'+c('CurrentUser').getID(),m=k.body;c('MercuryParticipants').get(l,function(n){var o=new RegExp(n.short_name,"i");if(o.test(m))i._notify(k);});},_notify:function j(k){var l=48,m=k.body;if(m.length>l)m=m.substr(0,l-3)+"...";new Notification(h._("\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u30bf\u30b0\u4ed8\u3051\u3055\u308c\u307e\u3057\u305f\uff01"),{body:m,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};f.exports=i;}),null);
__d('ChatTabViewInstances',['Map'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();f.exports=new (c('Map'))();}),null);
__d('ChatNewMessageHandler',['ChatActivity','ChatMentionsNotifications','ChatTabModel','ChatTabViewInstances','JSLogger','MercuryAssert','MercuryBrowserAlerts','UserActivity','MercuryConfig','MercuryThreadlistConstants'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('JSLogger').create('chat_new_message'),i={_notify:function j(k,l,m){if(c('MercuryConfig').DesktopNotificationsGK)c('ChatMentionsNotifications').notifyIfMessageToMe(l);var n=c('ChatTabViewInstances').get(k);m.view_is_visible=n&&n.isVisible();m.view_is_focused=n&&n.isFocused();if(!m.view_is_visible)h.log('message_to_hidden');m.is_active=c('ChatActivity').isActive();c('MercuryBrowserAlerts').messageReceived(l);},newMessage:function j(k,l){c('MercuryAssert').isThreadID(k);var m=c('ChatTabModel').getTab(k),n={thread_id:k,message_id:l.message_id,to_new_tab:!m,to_raised_tab:m?!!m.raised:true};this._notify(k,l,n);h.log('message',n);}};c('MercuryBrowserAlerts').subscribe('before-alert',function(j,event){var k=event.threadID,l=c('ChatTabViewInstances').get(k),m=c('ChatTabModel').getTab(k),n=c('MercuryThreadlistConstants').MESSAGE_NOTICE_INACTIVITY_THRESHOLD;if(m&&m.raised&&l&&l.isVisible()&&l.isFocused()&&c('UserActivity').isActive(n)){l.tryMarkAsRead();event.cancelAlert();}});f.exports=i;}),null);
__d('ChatTabLRUManager',['ChatTabViewInstances','ChatTabModel','InitialServerTime','MercuryThreads'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreads').get(),i={getLRUVisibleTab:function j(k){if(k.hasRoomForRaisedTab())return undefined;var l=Object.keys(k.getTabsToShow()||{}),m=1*60,n=null,o=Infinity;for(var p=0;p<l.length;p++){var q=l[p],r=h.getThreadMetaNow(q);if(c('ChatTabModel').isTabPromoted(q))continue;var s=c('ChatTabViewInstances').get(q);if(!(s&&s.hasEmptyInput())||!r)continue;var t=(c('InitialServerTime').serverTime-r.timestamp)/1000;if(!r.timestamp||r.timestamp&&r.timestamp<o&&t>m){n=r.thread_id;o=r.timestamp;}}return n;}};f.exports=i;}),null);
__d('ChatTabLazyFocus',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={_threadID:null,set:function i(j){this._threadID=j;},get:function i(){return this._threadID;},clear:function i(){this._threadID=undefined;}};f.exports=h;}),null);
__d('ChatTabPresence',['AvailableList','ChatTabModel','MercuryIDs'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};function i(j){var k=c('MercuryIDs').getUserIDFromThreadID(j);if(k)c('AvailableList').updateForID(k);}c('ChatTabModel').addListener(function(){var j=c('ChatTabModel').get();j.tabs.forEach(function(k){if(k.raised&&!h[k.id])i(k.id);});h={};j.tabs.forEach(function(k){if(k.raised)h[k.id]=true;});});f.exports={};}),null);
__d('ChatTabViewSelector',['Arbiter','ArbiterMixin','ChatTabActions','CSS','CurrentUser','DataStore','DOM','Event','FantaTabActions','MenuDeprecated','MercuryConfig','MercuryThreadInformer','MercuryThreads','MercuryThreadTitle.react','NubController','React','ReactDOM','ChatTabTemplates','Toggler'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadInformer').get(),i=c('MercuryThreads').get();function j(k){var l=c('ChatTabTemplates')[':fb:chat:tab:selector'].build(),m=l.getRoot(),n=l.getNode('menu'),o=c('DOM').find(n,'.uiMenuInner'),p={},q=new (c('NubController'))().init(m);c('CSS').hide(m);c('DOM').insertBefore(k,m);function r(u){var v=0;for(var w in p){var x=p[w],y=i.getThreadMetaNow(w),z=x.getNode('unreadCount'),aa=y&&y.unread_count||0;v+=aa;if(aa>9)aa='+';c('CSS').conditionClass(z,'invisible_elem',!aa);c('DOM').setContent(z,aa);}var ba=l.getNode('numMessages');c('CSS').conditionShow(ba,v);c('DOM').setContent(ba,v);}this.setTabData=function(u){var v=p;p={};if(u.length<1){c('CSS').hide(m);return;}c('CSS').show(m);c('DOM').empty(o);u.forEach(function(y){var z=c('ChatTabTemplates')[':fb:chat:tab:selector:item'].build(),aa=z.getNode('content');p[y.id]=z;i.getThreadMeta(y.id,function(ca){c('ReactDOM').render(c('React').createElement(c('MercuryThreadTitle.react'),{thread:ca,useAndSeparator:true,viewer:c('CurrentUser').getID()}),aa);});c('DOM').prependContent(o,z.getRoot());c('DataStore').set(z.getRoot(),'threadID',y.id);var ba=z.getNode('closeButton');c('Event').listen(ba,'click',function(event){if(c('MercuryConfig').FantaTabs){c('FantaTabActions').closeTab(y.id);}else c('ChatTabActions').closeTab(y.id,'selector/close-tab');event.kill();});});for(var w in v)if(v.hasOwnProperty(w)){var x=v[w].getNode('content');x&&c('ReactDOM').unmountComponentAtNode(x);}q.flyoutContentChanged();r();};function s(event,u){if(u.menu!=n)return;var v=c('DataStore').get(u.item,'threadID');j.inform('selected',v);c('Toggler').hide(m);}function t(event,u){c('MenuDeprecated').register(n);}c('MenuDeprecated').subscribe('select',s.bind(this));c('Toggler').listen('show',m,function(){c('Arbiter').inform('layer_shown',{type:'ChatTabSelector'});t();});c('Toggler').listen('hide',m,function(){c('Arbiter').inform('layer_hidden',{type:'ChatTabSelector'});});h.subscribe('threads-updated',r);}Object.assign(j,c('ArbiterMixin'));f.exports=j;}),null);
__d('ChatTabPolicy',['ChatBehavior','JSLogger','MercuryActionType','MercuryLogMessageType','MercuryAssert','MercuryBlockedParticipants','MercuryConfig','MercuryGroupThreadMentions','MercuryIDs','MercuryParticipantTypes','MercurySourceType','MercuryThreadActions','MercuryThreadInfo','MercuryViewer','MessagingTag','OzConstants','PresencePrivacy','Set','ShortProfiles','WorkModeConfig','isInFocusMode'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('MercuryBlockedParticipants').get(),i=c('MercuryThreadActions').get(),j=c('OzConstants').M_FBIDS,k=j.M_DEV,l=j.M,m=j.P,n=new (c('Set'))([k,l,m]),o=c('JSLogger').create('tab_policy');f.exports={messageIsAllowed:function p(q,r,s){var t=q.thread_id,u=r.message_id;c('MercuryAssert').isThreadID(t);c('MercuryAssert').isParticipantID(r.author);var v;if(c('MercuryThreadInfo').isMuted(q)){v={thread_id:t,message_id:u,mute_until:q.mute_until};o.log('message_thread_muted',v);if(c('MercuryConfig').GroupChatMentionsGK)c('MercuryGroupThreadMentions').messageMentionsViewer(r,function(y){if(y)s();});return;}if(c('isInFocusMode')(t)){v={thread_id:t,message_id:u,availability_mode:'focus'};o.log('message_thread_focus_mode',v);return;}if(q.read_only){v={thread_id:t,message_id:u,mode:q.mode};o.log('message_read_only',v);return;}if(r.source==c('MercurySourceType').EMAIL||r.source==c('MercurySourceType').TITAN_EMAIL_REPLY){v={thread_id:t,message_id:u,source:r.source};o.log('message_source_not_allowed',v);return;}var w=c('MercuryIDs').getUserIDFromParticipantID(r.author);if(!w){o.log('message_bad_author',{thread_id:t,message_id:u,user:w});return;}if(r.action_type!=c('MercuryActionType').USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(r,q)){v={thread_id:t,message_id:u,type:r.action_type};o.log('message_non_user_generated',v);return;}if(q.is_canonical_user&&!c('ChatBehavior').notifiesUserMessages()){o.log('message_jabber',{thread_id:t,message_id:u});i.markSeen(t,true);return;}if(q.is_canonical&&!q.other_user_fbid){o.log('message_canonical_contact',{thread_id:t,message_id:u});return;}if(q.folder!=c('MessagingTag').INBOX){o.log('message_folder',{thread_id:t,message_id:u,folder:q.folder});return;}if(h.isPresentInGroupThread(q)){v={thread_id:t,message_id:u};o.log('message_blocked_participants',v);return;}var x=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID());c('ShortProfiles').getMulti([w,x],function(y){if(!c('PresencePrivacy').allows(w)){o.log('message_privacy',{thread_id:t,message_id:u,user:w});return;}var z=y[w].employee&&y[x].employee,aa=c('WorkModeConfig').is_work_user;if(!z&&!aa&&!y[w].isCommercePage&&!n.has(w)&&y[w].type!==c('MercuryParticipantTypes').FRIEND&&y[w].type!==c('MercuryParticipantTypes').PAGE){o.log('message_non_friend',{thread_id:t,message_id:u,user:w});return;}s();});},_messageIsNewlyCreatedGroup:function p(q,r){return q.action_type===c('MercuryActionType').LOG_MESSAGE&&q.log_message_type===c('MercuryLogMessageType').THREAD_NAME&&r.message_count===1;}};}),null);
__d('FantaMercuryThreadEvents',['ChatTabPolicy','MercuryThreadInformer','MercuryThreads','MercuryViewer'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('MercuryThreadInformer').get(),i=c('MercuryThreads').get(),j={onMessagesReceived:function k(l){h.subscribe('messages-received',function(m,n){var o,p=function r(s){var t,u=n[s],v=function x(y){var z=u[y];if(z.author!=c('MercuryViewer').getID()){if(!z.is_unread)return 'continue';i.getThreadMeta(s,function(aa){c('ChatTabPolicy').messageIsAllowed(aa,z,function(){l(s,z);});});}};for(var w=0;w<u.length;w++){var t=v(w);if(t==='continue')continue;}};for(var q in n)p(q);});}};f.exports=j;}),null);
__d('ChatTabController',['ChatTabPresence','Arbiter','ChatActivity','ChatConfig','ChatNewMessageHandler','ChatTabActions','ChatTabLazyFocus','ChatTabLRUManager','ChatTabModel','ChatTabViewEvents','ChatTabViewInstances','ChatTabViewSelector','FantaMercuryThreadEvents','JSLogger','MercuryThreadActions','MercuryThreadInformer','MercuryThreads'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();c('ChatTabPresence');var h=c('MercuryThreadActions').get(),i=c('MercuryThreadInformer').get(),j=c('MercuryThreads').get(),k=c('ChatConfig').get('tab_auto_close_timeout')||7200000,l=c('JSLogger').create('tab_controller');function m(s,t,u){var v=c('ChatTabModel').get().tabs,w=v[s];if(!u&&v.length<2)return false;var x=v.slice(s+1),y=v.slice(0,s),z=x.concat(y);if(!t)z.reverse();if(w)z.push(w);for(var aa=0;aa<z.length;aa++){var ba=z[aa],ca=c('ChatTabViewInstances').get(ba.id),da=ba.raised||!u;if(ca&&ca.isVisible()&&da){ca.focus();return true;}}return false;}function n(s,t){var u=t&&t.getRightmostHiddenTab();if(u===s)return null;return u;}function o(){return Math.floor(Math.random()*2147483648).toString(16);}function p(s,t,u,v){c('ChatTabActions').raiseTab(s,true,u);var w=t&&t.getLeftmostVisibleTab(),x=t&&t.getTabsToShow();if(x&&!x[s]&&w){c('ChatTabModel').promoteThreadInPlaceOfThread(s,w,n(s,t),true);}else c('ChatTabActions').promoteTab(s);if(v)return;var y=c('ChatTabViewInstances').get(s);if(y){y.focus();}else c('ChatTabLazyFocus').set(s);}function q(s,t){if(!c('ChatTabModel').getTab(s))c('ChatTabActions').raiseTab(s,false);var u=t&&c('ChatTabLRUManager').getLRUVisibleTab(t),v=t&&t.getTabsToShow();if(v&&!v[s]&&u)c('ChatTabModel').promoteThreadInPlaceOfThread(s,u,n(s,t));}function r(s){c('ChatTabViewSelector').subscribe('selected',function(t,u){p(u,s);});c('Arbiter').subscribe('page_transition',function(t,u){c('ChatTabActions').closeFragileTabs();});c('Arbiter').subscribe('chat-visibility/go-offline',function(){c('ChatTabActions').closeAllTabs();});c('ChatActivity').subscribe('idle',function(t,u){if(u>k){var v=c('ChatTabModel').get().tabs;v.forEach(function(w){var x=w.id;j.getThreadMeta(x,function(y){if(!y.unread_count){l.log('autoclose_idle_seen',{thread_id:x,idleness:u});c('ChatTabActions').closeTab(x,'autoclose_idle_seen');}});});}});c('ChatTabViewEvents').subscribe('nub-activated',function(t,u){p(u,s);});c('ChatTabViewEvents').subscribe('focus-tab',function(t,u){var v=c('ChatTabModel').getTab(u);if(v&&v.raised)p(u,s,v.signatureID,false);});c('ChatTabViewEvents').subscribe('interaction-with-tab',function(t,u){var v=c('ChatTabModel').getTab(u);v&&v.raised&&h.markSeen(u);});c('ChatTabViewEvents').subscribe('esc-pressed',function(t,u){l.log('close_esc',{thread_id:u});var v=c('ChatTabModel').indexOf(u);c('ChatTabActions').closeTab(u,'close_esc');setTimeout(function(){m(v-1,true,true);},0);});c('FantaMercuryThreadEvents').onMessagesReceived(function(t,u){q(t,s);c('ChatNewMessageHandler').newMessage(t,u);});i.subscribe('thread-read-changed',function(t,u){for(var v in u)if(!u[v].mark_as_read){l.log('autoclose_marked_unread',{thread_id:v});c('ChatTabActions').closeTab(v,'autoclose_marked_unread');}});c('ChatTabViewEvents').subscribe('tab-pressed',function(t,u){return !m(c('ChatTabModel').indexOf(u.id),u.shiftPressed);});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(t,u){u.chat_controller={auto_close_timeout:k};});this.openTab=function(t,u,v,w){p(t,u,o(),w);if(v)v(c('ChatTabViewInstances').get(t));};}f.exports=r;}),null);
__d('ChatTabViewCoordinator',['Arbiter','Bootloader','ChatTabModel','ChatTabViewSelector','CSS','ErrorUtils','FBRTCSupport','LogHistory','MercuryIDs'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('chat_tab_coordinator');function i(j,k){var l=new (c('ChatTabViewSelector'))(j),m={},n=false;function o(){var s=c('ChatTabModel').get(),t={};s.tabs.forEach(function(v){t[v.id]=1;});h.log('process_tab_changed',{model_tabs:Object.keys(t),view_tabs:Object.keys(m)});for(var u in m)if(!t[u]){h.log('remove_tab',{tab_id:u});m[u].destroy();delete m[u];}p(s,function(){q(s);if(s.tabNeedsFocus&&!s.tabNeedsFocus.isFocused())s.tabNeedsFocus.focus();});}function p(s,t){if(!s.tabs.length){t();return;}c('Bootloader').loadModules(["ChatTabView"],function(u){var v=null,w=s.tabs.find(function(x){var y=x.id;return c('MercuryIDs').isGroupChat(y);});s.tabs.forEach(function(x){var y=x.id,z=false;if(!m[y]){h.log('add_tab',{tab_id:y});m[y]=new u(y,x.server_id,x.signatureID,j,v,x===w);z=true;}else{m[y].updateSignatureID(x.signatureID);m[y].updateIsLastTab(x===w);}if(m[y].isFocused())s.tabNeedsFocus=m[y];if(!z&&!m[y].nextTabIs(v)){var aa=m[y].getScrollTop();if(v){try{m[y].insertBefore(v);}catch(ba){h.log('insertBeforeFailed','{}');m[y].appendTo(j);c('ErrorUtils').reportError(ba);}}else m[y].appendTo(j);if(aa)m[y].setScrollTop(aa);}v=m[y];});t();},'ChatTabViewCoordinator');}function q(s){var t=k.getTabsToShow(s),u=[],v=false;s.tabs.forEach(function(w){if(!t[w.id]){m[w.id].setVisibleState(false,w.raised);u.push(w);}});s.tabs.forEach(function(w){if(t[w.id]){m[w.id].setVisibleState(true,w.raised);v|=w.raised;}});l.setTabData(u);r(v);}function r(s){if(!s&&n){c('Arbiter').inform('layer_hidden',{type:'ChatTab'});n=false;}else if(s&&!n){c('Arbiter').inform('layer_shown',{type:'ChatTab'});n=true;}}if(c('FBRTCSupport').isSendWebrtcSupported())c('CSS').addClass(j,'videoCallEnabled');k.subscribe('tabs-changed',o);o();}f.exports=i;}),null);
__d('MercuryChannelMessageTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){var k={author:i.mercury_author_id,author_email:i.mercury_author_email,body:i.body,subject:i.subject,has_attachment:i.has_attachment,attachments:i.attachments,ephemeral_ttl_mode:i.ephemeral_ttl_mode,html_body:i.html_body,thread_id:i.tid,thread_fbid:i.thread_fbid&&i.thread_fbid.toString(),other_user_fbid:i.other_user_fbid&&i.other_user_fbid.toString(),offline_threading_id:i.offline_threading_id,message_id:i.mid,is_spoof_warning:i.is_spoof_warning,ranges:i.ranges,source:i.mercury_source,source_tags:i.mercury_source_tags,tags:i.tags&&i.tags.split(','),threading_id:i.threading_id,timestamp:i.timestamp,timestamp_absolute:i.timestamp_absolute,timestamp_relative:i.timestamp_relative,timestamp_datetime:i.timestamp_datetime,timestamp_time_passed:i.timestamp_time_passed,action_type:c('MercuryActionType').USER_GENERATED_MESSAGE,is_unread:i.is_unread,is_forward:false,forward_count:i.forward_count||i.forward,forward_message_ids:i.forward_msg_ids,folder:j,sync_id:i.sync_id};return k;}f.exports={transform:h};}),null);
__d('MercuryDelayedDispatcher',['MercuryDispatcher','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(j){this.$MercuryDelayedDispatcher1=j;this.$MercuryDelayedDispatcher2=[];this.$MercuryDelayedDispatcher3=c('MercuryThreadIDMap').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4=c('MercuryDispatcher').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher5=c('MercuryServerRequests').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher6=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4.subscribe('model-update-completed',function(k,l){return this.$MercuryDelayedDispatcher7();}.bind(this));}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.handleUpdateWaitForThread=function(j,k){var l=this.$MercuryDelayedDispatcher3.getClientIDFromServerIDNow(k);if(l){this.$MercuryDelayedDispatcher8(j);return;}this.$MercuryDelayedDispatcher3.getClientIDFromServerID(k,function(){return this.$MercuryDelayedDispatcher2.push(j);}.bind(this));this.$MercuryDelayedDispatcher5.ensureThreadIsFetched(k);};h.prototype.$MercuryDelayedDispatcher7=function(){if(this.$MercuryDelayedDispatcher2&&this.$MercuryDelayedDispatcher2.length){var j=this.$MercuryDelayedDispatcher2[0];this.$MercuryDelayedDispatcher2=this.$MercuryDelayedDispatcher2.slice(1);this.$MercuryDelayedDispatcher8(j);}};h.prototype.$MercuryDelayedDispatcher8=function(j){if(j.from_client){this.$MercuryDelayedDispatcher4.handleUpdate(j);}else this.$MercuryDelayedDispatcher6.handleUpdate(j);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryChannelHandlerDEPRECATED',['Arbiter','ChannelConstants','LogHistory','MercuryActionType','MercuryChannelMessageTransformer','MercuryDelayedDispatcher','MercuryGlobalActionType','MercuryLogMessageType','MercuryMessages','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySingletonProvider','MercuryThreadInformer','MercuryViewer','MessagingEvent','MessagingTag','PresenceUtil','mixin'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('mercury_channel_handler');i.get=function(){return j.get();};i.getForFBID=function(k){return j.getForFBID(k);};function i(k){this.$MercuryChannelHandlerDEPRECATED1=k;this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryChannelHandlerDEPRECATED1);this.$MercuryChannelHandlerDEPRECATED2=c('MercuryThreadInformer').getForFBID(this.$MercuryChannelHandlerDEPRECATED1);this.$MercuryChannelHandlerDEPRECATED3=c('MercuryMessages').getForFBID(this.$MercuryChannelHandlerDEPRECATED1);this.__delayedDispatcher=c('MercuryDelayedDispatcher').getForFBID(this.$MercuryChannelHandlerDEPRECATED1);this.$MercuryChannelHandlerDEPRECATED4=[];}i.prototype.getInstanceFBID=function(){return this.$MercuryChannelHandlerDEPRECATED1;};i.prototype.$MercuryChannelHandlerDEPRECATED5=function(k,l){if(!this.$MercuryChannelHandlerDEPRECATED6(k)||!l.obj.thread_fbids&&!l.obj.other_user_fbids)return;var m=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE,n=void 0;(l.obj.thread_fbids||[]).forEach(function(o){if(l.obj.event==c('MessagingEvent').TAG){n=l.obj.tag;}else n=l.obj.marked_as_spam?c('MessagingTag').SPAM:c('MessagingTag').INBOX;var p={action_type:c('MercuryActionType').CHANGE_FOLDER,thread_fbid:o.toString(),other_user_fbid:null,new_folder:n};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},p)],payload_source:m},o.toString());},this);(l.obj.other_user_fbids||[]).forEach(function(o){if(l.obj.event==c('MessagingEvent').TAG){n=l.obj.tag;}else n=l.obj.marked_as_spam?c('MessagingTag').SPAM:c('MessagingTag').INBOX;var p={action_type:c('MercuryActionType').CHANGE_FOLDER,other_user_fbid:o.toString(),thread_fbid:null,new_folder:n};this.__delayedDispatcher.handleUpdateWaitForThread({actions:[babelHelpers['extends']({},p)],payload_source:m},o.toString());},this);};i.prototype.$MercuryChannelHandlerDEPRECATED7=function(k,l){if(!this.$MercuryChannelHandlerDEPRECATED6(k)||!l.obj.tag)return;switch(l.obj.tag){case c('MessagingTag').INBOX:case c('MessagingTag').OTHER:this.$MercuryChannelHandlerDEPRECATED5(k,l);break;}};i.prototype.__markAsSeen=function(k,l){if(!this.$MercuryChannelHandlerDEPRECATED8(k)||!l.obj||!l.obj.seen_timestamp)return;this.__payloadPreprocessor.handleUpdate({message_counts:[{seen_timestamp:l.obj.seen_timestamp,folder:c('MessagingTag').INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:c('MessagingTag').INBOX}],payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};i.prototype.__handleMessagingPayload=function(k,l){switch(l.obj.event){case c('MessagingEvent').TAG:this.$MercuryChannelHandlerDEPRECATED7(k,l);break;case c('MessagingEvent').REPORT_SPAM:this.$MercuryChannelHandlerDEPRECATED5(k,l);break;}};i.prototype.getRouting=function(){return {messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};i.prototype.__getMessagingPayloadType=function(){return c('ChannelConstants').getArbiterType('messaging');};i.prototype.__getMercuryPayloadType=function(){return c('ChannelConstants').getArbiterType('mercury');};i.prototype.__getInboxPayloadType=function(){return c('ChannelConstants').getArbiterType('inbox');};i.prototype.$MercuryChannelHandlerDEPRECATED6=function(k){return k===this.__getMessagingPayloadType();};i.prototype.$MercuryChannelHandlerDEPRECATED9=function(k){return k===this.__getMercuryPayloadType();};i.prototype.$MercuryChannelHandlerDEPRECATED8=function(k){return k===this.__getInboxPayloadType();};i.prototype.turnOn=function(){if(!this.$MercuryChannelHandlerDEPRECATED4.length){var k=this.getRouting();for(var l in k)this.$MercuryChannelHandlerDEPRECATED4.push(c('Arbiter').subscribe(c('ChannelConstants').getArbiterType(l),k[l].bind(this)));}return this;};i.prototype.turnOff=function(){if(this.$MercuryChannelHandlerDEPRECATED4.length){this.$MercuryChannelHandlerDEPRECATED4.forEach(c('Arbiter').unsubscribe);this.$MercuryChannelHandlerDEPRECATED4=[];}return this;};i.prototype.__shouldDropLogMessageBecauseOfSync=function(k){switch(k.log_message_type){case c('MercuryLogMessageType').UNSUBSCRIBE:case c('MercuryLogMessageType').SUBSCRIBE:case c('MercuryLogMessageType').THREAD_NAME:case c('MercuryLogMessageType').VIDEO_CALL:case c('MercuryLogMessageType').PHONE_CALL:case c('MercuryLogMessageType').THREAD_IMAGE:case c('MercuryLogMessageType').ORION:case c('MercuryLogMessageType').PAGE_REPLY:case c('MercuryLogMessageType').GENERIC_ADMIN_TEXT:return true;case c('MercuryLogMessageType').SERVER_ERROR:case c('MercuryLogMessageType').LIVE_LISTEN:case c('MercuryLogMessageType').SWITCH_TO_WORK:case c('MercuryLogMessageType').WALLPAPER:default:break;}return false;};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryDeliveryReceipts',['ArbiterMixin','Map','MercuryDispatcher','MercurySingletonProvider','mixin'],(function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(l){'use strict';i.constructor.call(this);this.$MercuryDeliveryReceipts2=l;this.$MercuryDeliveryReceipts3=new (c('Map'))();this.$MercuryDeliveryReceipts1=c('MercuryDispatcher').getForFBID(this.$MercuryDeliveryReceipts2);this.$MercuryDeliveryReceipts1.subscribe('update-delivery',function(m,n){if(n.delivery_receipts)for(var o in n.delivery_receipts){var p=n.delivery_receipts[o],q=this.$MercuryDeliveryReceipts3.get(o)||0;if(p>q){this.$MercuryDeliveryReceipts3.set(o,p);this.informDeliveryStatusChanged(o);}}}.bind(this));}j.getForFBID=function(l){'use strict';return k.getForFBID(l);};j.get=function(){'use strict';return k.get();};j.prototype.informDeliveryStatusChanged=function(l){'use strict';var m=new (c('Map'))();m.set(l,true);this.inform('change',m);};j.prototype.getDeliveryTime=function(l){'use strict';return this.$MercuryDeliveryReceipts3.get(l)||0;};var k=new (c('MercurySingletonProvider'))(j);f.exports=j;}),null);
__d('MercurySyncDeltaHolder',['Map'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.$MercurySyncDeltaHolder1=new (c('Map'))();this.$MercurySyncDeltaHolder2=[];}h.prototype.peek=function(){this.$MercurySyncDeltaHolder2=this.$MercurySyncDeltaHolder2.sort(function(i,j){return i-j;});return this.$MercurySyncDeltaHolder2[0];};h.prototype.pop=function(){this.$MercurySyncDeltaHolder2=this.$MercurySyncDeltaHolder2.sort(function(k,l){return k-l;});if(this.$MercurySyncDeltaHolder2.length===0)return undefined;var i=this.$MercurySyncDeltaHolder2.shift(),j=this.$MercurySyncDeltaHolder1.get(i);this.$MercurySyncDeltaHolder1['delete'](i);return {seqID:i,delta:j};};h.prototype.push=function(i,j){if(this.$MercurySyncDeltaHolder1.has(i))return;this.$MercurySyncDeltaHolder1.set(i,j);this.$MercurySyncDeltaHolder2.push(i);};f.exports=h;}),null);
__d('MercuryMessageCustomizations',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(j,k){var l=j.customizations;if(!l)return null;var m=l.filter(function(n){return n.customization_type===k;});return m.length>0?m[0].customization_value:null;}function i(j){var k=JSON.parse(j),l=[];Object.keys(k).forEach(function(m){l.push({customization_type:m,customization_value:k[m]});});return l;}f.exports={getCustomizationValue:h,parseCustomizations:i};}),null);
__d('MercurySyncNewMessageTransformer',['IrisProtocolMessageLifetime','MercuryActionType','MercuryConfig','MercuryIDs','MercuryMessageCustomizations','MercuryTimestamp','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=function j(k){var l={};try{l=JSON.parse(k);}catch(m){}return l;};function i(j,k){var l=parseInt(k.messageMetadata.timestamp,10),m=c('MercuryTimestamp').getFormatedTimestamp(l),n=k.messageMetadata.skipBumpThread&&c('MercuryConfig').WWWMessengerSkipBumpThread,o=j!==k.messageMetadata.actorFbId,p=[];if(k.attachments)p=k.attachments.map(function(r){return r.mercury;});var q=k.messageMetadata.tags?k.messageMetadata.tags[0]:undefined;return {message_id:k.messageMetadata.messageId,threading_id:null,offline_threading_id:k.messageMetadata.offlineThreadingId,author:c('MercuryIDs').getParticipantIDFromUserID(k.messageMetadata.actorFbId),author_email:k.messageMetadata.actorFbId+'@facebook.com',ephemeral_ttl_mode:k.ttl?c('IrisProtocolMessageLifetime')[k.ttl]:0,timestamp:l,timestamp_absolute:m.absolute,timestamp_relative:m.relative,timestamp_datetime:m.relative,timestamp_time_passed:c('MercuryTimestamp').getTimeBucket(l),is_unread:o,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,forward_count:0,forward_message_ids:[],source:q,tags:k.messageMetadata.tags,is_spoof_warning:false,folder:c('MessagingTag').INBOX,thread_fbid:k.messageMetadata.threadKey.threadFbId,other_user_fbid:k.messageMetadata.threadKey.otherUserFbId,body:k.body!==undefined?k.body:'',html_body:null,subject:null,has_attachment:p.length>0,attachments:p,ranges:undefined,thread_id:null,action_type:c('MercuryActionType').USER_GENERATED_MESSAGE,is_from_iris:true,is_sponsored:!!(k.data&&k.data.is_sponsored&&k.data.is_sponsored==='true'),commerce_message_type:k.data?k.data.commerce_message_type:null,customizations:k.data&&k.data.customization?c('MercuryMessageCustomizations').parseCustomizations(k.data.customization):null,platform_xmd:k.data&&k.data.platform_xmd?k.data.platform_xmd:null,message_source:k.data&&k.data.message_source_data?h(k.data.message_source_data).message_source:null,skip_bump_thread:n,montage_reply_data:k.data&&k.data.montage_reply_data?JSON.parse(k.data.montage_reply_data):null};}f.exports={transform:i};}),null);
__d('MercurySyncAdminTextMessageTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={message_type:j.type,untypedData:j.untypedData};k.log_message_type=c('MercuryLogMessageType').GENERIC_ADMIN_TEXT;return k;}f.exports={transform:h};}),null);
__d('MercurySyncClientPayloadTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j=i.payload;j=JSON.parse(String.fromCharCode.apply(null,j));var k=j&&j.deltas,l=k[0],m=l&&l.deltaPaymentPinProtectionStatusData,n=m&&m.threadKey&&m.threadKey.otherUserFbId,o=m&&m.isPinProtected,p=n?n.toString():'';return {action_type:c('MercuryActionType').IS_PIN_PROTECTED,thread_fbid:p,is_pin_protected:o};}f.exports={transform:h};}),null);
__d('MercurySyncDeliveryReceiptTransformer',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {delivery_receipts:[{other_user_fbid:i.threadKey.otherUserFbId?i.threadKey.otherUserFbId:'',thread_fbid:i.threadKey.threadFbId?i.threadKey.threadFbId:'',time:parseInt(i.deliveredWatermarkTimestampMs,10)}]};}f.exports={transform:h};}),null);
__d('MercurySyncMarkReadTransformer',['MercuryActionType','MercuryGlobalActionType','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){if(i.folders&&i.folders.length>0)return i.folders.map(function(j){return {action_type:c('MercuryGlobalActionType').MARK_ALL_READ,action_id:null,folder:j,timestamp:parseInt(i.watermarkTimestamp,10)};});return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').CHANGE_READ_STATUS,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId,mark_as_read:true,timestamp:parseInt(i.watermarkTimestamp,10),folder:c('MessagingTag').INBOX};});}f.exports={transform:h};}),null);
__d('MercurySyncMarkUnreadTransformer',['MercuryActionType','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').CHANGE_READ_STATUS,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId,mark_as_read:false,timestamp:parseInt(i.watermarkTimestamp,10),folder:c('MessagingTag').INBOX};});}f.exports={transform:h};}),null);
__d('MercurySyncMessageDeleteTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {action_type:c('MercuryActionType').DELETE_MESSAGES,message_ids:i.messageIds,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};}f.exports={transform:h};}),null);
__d('MercurySyncPagesManagerEventTransformer',['MercuryActionType','PagesMessagingEventType'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j=JSON.parse(i.jsonBlob),k=j&&j.type;if(!k)return undefined;switch(k){case c('PagesMessagingEventType').FLAG:var l=!!(j&&j.flagData&&j.flagData.state),m={action_type:c('MercuryActionType').CHANGE_FLAG,mark_as_flag:l,mark_as_priority:null,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};return m;case c('PagesMessagingEventType').PRIORITY_UPDATE:var n=!!(j&&j.priorityData&&j.priorityData.state),o={action_type:c('MercuryActionType').UPDATE_PRIORITY,mark_as_flag:null,mark_as_priority:n,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};return o;default:return undefined;}}f.exports={transform:h};}),null);
__d('MercurySyncParticipantLeftGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={removed_participants:[c('MercuryIDs').getParticipantIDFromUserID(j.leftParticipantFbId)]};k.log_message_type=c('MercuryLogMessageType').UNSUBSCRIBE;return k;}f.exports={transform:h};}),null);
__d('MercurySyncParticipantsAddedToGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={added_participants:j.addedParticipants.map(function(l){return (c('MercuryIDs').getParticipantIDFromUserID(l.userFbId));})};k.log_message_type=c('MercuryLogMessageType').SUBSCRIBE;return k;}f.exports={transform:h};}),null);
__d('MercurySyncRTCEventLogTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j),l=j.messageMetadata.actorFbId,m=l===i?j.messageMetadata.threadKey.otherUserFbId:i;k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={answered:j.duration>0,callee:c('MercuryIDs').getParticipantIDFromUserID(m),caller:c('MercuryIDs').getParticipantIDFromUserID(l)};k.log_message_type=c('MercuryLogMessageType').VIDEO_CALL;return k;}f.exports={transform:h};}),null);
__d('MercurySyncReadReceiptTransformer',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j={watermark:parseInt(i.watermarkTimestampMs,10),action:parseInt(i.actionTimestampMs,10)},k=i.threadKey.otherUserFbId||i.actorFbId,l=i.threadKey.otherUserFbId||i.threadKey.threadFbId,m={roger:{}};m.roger[l]={};m.roger[l][k]=j;return m;}f.exports={transform:h};}),null);
__d('MercurySyncReplaceMessageTransformer',['MercuryActionType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j){j=Object.assign({},j.newMessage,j);return Object.assign(c('MercurySyncNewMessageTransformer').transform(i,j),{action_type:c('MercuryActionType').REPLACE_MESSAGE,replaced_message_id:j.replacedMessageId});}f.exports={transform:h};}),null);
__d('MercurySyncThreadActionTransformer',['MercuryActionType','MessagingThreadAction'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j={action_type:c('MercuryActionType').CHANGE_ARCHIVED_STATUS,thread_fbid:i.threadKey.threadFbId,other_user_fbid:i.threadKey.otherUserFbId,archived:i.action===c('MessagingThreadAction').ACTION_ARCHIVED};return j;}f.exports={transform:h};}),null);
__d('MercurySyncThreadAdminsAddToGroupTransformer',['MercuryActionType','MercuryIDs'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {action_type:c('MercuryActionType').ADD_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,added_admin_ids:i.addedAdmins.map(function(j){return c('MercuryIDs').getParticipantIDFromUserID(j.userFbId);})};}f.exports={transform:h};}),null);
__d('MercurySyncThreadAdminsRemovedFromGroupTransformer',['MercuryActionType','MercuryIDs'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {action_type:c('MercuryActionType').REMOVE_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_admin_ids:i.removedAdminFbIds.map(function(j){return c('MercuryIDs').getParticipantIDFromUserID(j);})};}f.exports={transform:h};}),null);
__d('MercurySyncThreadApprovalModeTransformer',['MercuryActionType','MessengerApprovalModeTypes'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {action_type:c('MercuryActionType').APPROVAL_MODE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,approval_mode:c('MessengerApprovalModeTypes')[i.mode]};}f.exports={transform:h};}),null);
__d('MercurySyncThreadApprovalQueueTransformer',['MercuryActionType','MercuryIDs','MessengerApprovalQueueTypes'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j=c('MercuryIDs').getParticipantIDFromUserID(i.recipientFbId);return {action_type:c('MercuryActionType').APPROVAL_QUEUE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_id:i.action===c('MessengerApprovalQueueTypes').REMOVED?j:null,added_id:i.action===c('MessengerApprovalQueueTypes').REQUESTED?j:null};}f.exports={transform:h};}),null);
__d('MercurySyncThreadDeleteTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').DELETE_THREAD,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId};});}f.exports={transform:h};}),null);
__d('MercurySyncThreadJoinableModeTransformer',['MercuryActionType','MessengerJoinableModeType'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){return {action_type:c('MercuryActionType').JOINABLE_MODE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,joinable_mode:{mode:c('MessengerJoinableModeType')[i.mode],link:i.link}};}f.exports={transform:h};}),null);
__d('MercurySyncThreadMuteSettingsTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){var j={action_type:c('MercuryActionType').CHANGE_MUTE_SETTINGS,thread_fbid:i.threadKey.threadFbId,other_user_fbid:i.threadKey.otherUserFbId,mute_until:parseInt(i.expireTime,10)};return j;}f.exports={transform:h};}),null);
__d('MercurySyncThreadNameTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={name:j.name};k.log_message_type=c('MercuryLogMessageType').THREAD_NAME;return k;}f.exports={transform:h};}),null);
__d('MontageDispatcher',['ExplicitRegistrationDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('ExplicitRegistrationDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('MontageActions',['MontageDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({REQUEST_UPDATE:null,HAS_UPDATED:null}),i={Types:h,requestUpdate:function j(k){c('MontageDispatcher').dispatch({type:h.REQUEST_UPDATE,threadFBID:k});},hasUpdated:function j(k){c('MontageDispatcher').dispatch({type:h.HAS_UPDATED,threadFBID:k});}};f.exports=i;}),null);
__d('MercurySyncDispatcher',['MercuryDelayedDispatcher','MercuryGlobalActionType','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySyncThreadAdminsAddToGroupTransformer','MercurySyncThreadAdminsRemovedFromGroupTransformer','MercurySyncAdminTextMessageTransformer','MercurySyncClientPayloadTransformer','MercurySyncDeliveryReceiptTransformer','MercurySyncMarkReadTransformer','MercurySyncMarkUnreadTransformer','MercurySyncMessageDeleteTransformer','MercurySyncNewMessageTransformer','MercurySyncReadReceiptTransformer','MercurySyncPagesManagerEventTransformer','MercurySyncParticipantLeftGroupThreadTransformer','MercurySyncParticipantsAddedToGroupThreadTransformer','MercurySyncRTCEventLogTransformer','MercurySyncThreadDeleteTransformer','MercurySyncThreadMuteSettingsTransformer','MercurySyncThreadNameTransformer','MercurySyncThreadActionTransformer','MercurySyncReplaceMessageTransformer','MercurySyncThreadJoinableModeTransformer','MercurySyncThreadApprovalModeTransformer','MercurySyncThreadApprovalQueueTransformer','MercurySyncDeltaTypes','MercurySingletonProvider','MontageActions'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercurySyncDispatcher1=j;this.$MercurySyncDispatcher2=c('MercuryDelayedDispatcher').getForFBID(this.$MercurySyncDispatcher1);this.$MercurySyncDispatcher3=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercurySyncDispatcher1);}h.prototype.process=function(j){var k=void 0;switch(j['class']){case c('MercurySyncDeltaTypes').NewMessage:k=c('MercurySyncNewMessageTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ReplaceMessage:k=c('MercurySyncReplaceMessageTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').DeliveryReceipt:k=c('MercurySyncDeliveryReceiptTransformer').transform(j);this.$MercurySyncDispatcher3.handleUpdate(k);break;case c('MercurySyncDeltaTypes').MarkRead:k=c('MercurySyncMarkReadTransformer').transform(j);var l=false;for(var m=0;m<k.length;m++){var n=k[m];if(n.action_type===c('MercuryGlobalActionType').MARK_ALL_READ)l=true;}if(l)return;this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').MarkUnread:k=c('MercurySyncMarkUnreadTransformer').transform(j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').ParticipantLeftGroupThread:k=c('MercurySyncParticipantLeftGroupThreadTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ParticipantsAddedToGroupThread:k=c('MercurySyncParticipantsAddedToGroupThreadTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').RTCEventLog:k=c('MercurySyncRTCEventLogTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ThreadName:k=c('MercurySyncThreadNameTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ReadReceipt:k=c('MercurySyncReadReceiptTransformer').transform(j);this.$MercurySyncDispatcher3.handleUpdate(k);break;case c('MercurySyncDeltaTypes').AdminTextMessage:k=c('MercurySyncAdminTextMessageTransformer').transform(this.$MercurySyncDispatcher1,j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').MessageDelete:k=c('MercurySyncMessageDeleteTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ThreadAction:k=c('MercurySyncThreadActionTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ThreadDelete:k=c('MercurySyncThreadDeleteTransformer').transform(j);this.$MercurySyncDispatcher5(k);break;case c('MercurySyncDeltaTypes').AdminAddedToGroupThread:k=c('MercurySyncThreadAdminsAddToGroupTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').AdminRemovedFromGroupThread:k=c('MercurySyncThreadAdminsRemovedFromGroupTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ThreadMuteSettings:k=c('MercurySyncThreadMuteSettingsTransformer').transform(j);this.$MercurySyncDispatcher5([k]);break;case c('MercurySyncDeltaTypes').PagesManagerEvent:k=c('MercurySyncPagesManagerEventTransformer').transform(j);if(!k)return;this.$MercurySyncDispatcher5([k]);break;case c('MercurySyncDeltaTypes').JoinableMode:k=c('MercurySyncThreadJoinableModeTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ApprovalMode:k=c('MercurySyncThreadApprovalModeTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ApprovalQueue:k=c('MercurySyncThreadApprovalQueueTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').ClientPayload:k=c('MercurySyncClientPayloadTransformer').transform(j);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').GenieMessage:k=c('MercurySyncNewMessageTransformer').transform(this.$MercurySyncDispatcher1,j.deltaNewMessage);this.$MercurySyncDispatcher4(k);break;case c('MercurySyncDeltaTypes').MontageMessage:var o=j.newMessage.messageMetadata.actorFbId;if(o)c('MontageActions').requestUpdate(o);default:break;}};h.prototype.$MercurySyncDispatcher4=function(j){var k=j.other_user_fbid||j.thread_fbid;this.$MercurySyncDispatcher2.handleUpdateWaitForThread({actions:[j],payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE},k);};h.prototype.$MercurySyncDispatcher5=function(j){this.$MercurySyncDispatcher3.handleUpdate({actions:j,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercurySyncDataFetcherImpl',['Promise','AsyncRequest','MessagingConfig','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('MessagingConfig').syncFetchRequestTimeoutMs;function i(k){return new (c('Promise'))(function(l,m){j(k,l,m,0);});}function j(k,l,m,n){if(n>c('MessagingConfig').syncFetchRetries){m();return;}var o=n===0?0:c('MessagingConfig').syncFetchInitialTimeoutMs*Math.pow(c('MessagingConfig').syncFetchTimeoutMultiplier,n);c('setTimeoutAcrossTransitions')(function(){var p=false,q=function r(){if(p)return;p=true;j(k,l,m,n+1);};new (c('AsyncRequest'))().setURI(k).setHandler(function(r){p=true;l(r);}).setErrorHandler(q).setTimeoutHandler(h,q).setAllowCrossPageTransition(true).send();},o);}f.exports={fetch:i};}),null);
__d('MercurySyncDataFetcher',['Promise','LogHistory','MessagingConfig','MercurySyncDataFetcherImpl','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('LogHistory').getInstance('mercury_sync_data_fetcher');function i(){var l=0;for(var m=0;m<c('MessagingConfig').syncFetchRetries;m++){var n=m===0?0:c('MessagingConfig').syncFetchInitialTimeoutMs*Math.pow(c('MessagingConfig').syncFetchTimeoutMultiplier,m);l+=n+c('MessagingConfig').syncFetchRequestTimeoutMs;}return l;}var j=i();function k(l){return new (c('Promise'))(function(m,n){c('MercurySyncDataFetcherImpl').fetch(l).done(m,n);c('setTimeoutAcrossTransitions')(function(){h.error('fetch_timeout',JSON.stringify({timeout:j,uri:l.toString()}));n();},j);});}f.exports={fetch:k,getMaxTimeoutMs:i};}),null);
__d("XMercuryFetchMessageController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/fetch_message\/",{other_user_or_thread_fbid:{type:"Int",required:true},mid:{type:"String",required:true}});}),null);
__d("XMercuryInvalidateGlobalStateController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/invalidate_global_state\/",{});}),null);
__d("XMercuryInvalidateThreadStateController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/mercury\/invalidate_thread_state\/",{other_user_or_thread_fbid:{type:"Int",required:true},num_messages:{type:"Int",required:true}});}),null);
__d('MercurySyncDFFDataFetcher',['Promise','ActorURI','AsyncRequest','MercuryMessages','MercuryThreads','MercuryThreadIDMap','MercurySingletonProvider','MercurySyncDataFetcher','XMercuryFetchMessageController','XMercuryInvalidateGlobalStateController','XMercuryInvalidateThreadStateController'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(j){this.$MercurySyncDFFDataFetcher1=j;this.__messages=c('MercuryMessages').getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threads=c('MercuryThreads').getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threadIDMap=c('MercuryThreadIDMap').getForFBID(this.$MercurySyncDFFDataFetcher1);}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.fetchInvalidateGlobalState=function(){var j=c('XMercuryInvalidateGlobalStateController').getURIBuilder().getURI(),k=c('ActorURI').create(j,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(k);};h.prototype.fetchInvalidateThreadState=function(j,k){var l=11,m=3,n=j||k,o=this.__threadIDMap.getClientIDFromServerIDNow(n);if(!o)return c('Promise').resolve({getPayload:function s(){return {};}});var p=m+this.__messages.getCurrentlyLoadedMessages(o).length,q=c('XMercuryInvalidateThreadStateController').getURIBuilder().setInt('other_user_or_thread_fbid',n).setInt('num_messages',Math.max(p,l)).getURI(),r=c('ActorURI').create(q,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(r);};h.prototype.fetchInvalidateMessage=function(j,k,l){var m=c('XMercuryFetchMessageController').getURIBuilder().setInt('other_user_or_thread_fbid',j||k).setString('mid',l).getURI(),n=c('ActorURI').create(m,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(n);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercurySyncForcedFetchHandler',['Promise','MercurySingletonProvider','MercurySyncDFFDataFetcher','MercuryMessages','MercuryThreadIDMap'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(k){return {getPayload:function l(){return {sequence_id:k};}};}i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercurySyncForcedFetchHandler1=k;this.$MercurySyncForcedFetchHandler2=c('MercuryMessages').getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler3=c('MercuryThreadIDMap').getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler4=c('MercurySyncDFFDataFetcher').getForFBID(this.$MercurySyncForcedFetchHandler1);}i.prototype.processMessageDFF=function(k,l,m,n){if(n){var o=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),p=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(o);if(p===undefined)return c('Promise').resolve(h(k));var q=this.$MercurySyncForcedFetchHandler2.getMessagesFromIDs([m]);if(q.length===0)return c('Promise').resolve(h(k));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateMessage(l.otherUserFbId,l.threadFbId,m);};i.prototype.processThreadDFF=function(k,l,m){if(m){var n=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),o=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(n);if(o===undefined)return c('Promise').resolve(h(k));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateThreadState(l.otherUserFbId,l.threadFbId);};i.prototype.processGlobalDFF=function(){return this.$MercurySyncForcedFetchHandler4.fetchInvalidateGlobalState();};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercurySyncHolesTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$MercurySyncHolesTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$MercurySyncHolesTypedLogger1=babelHelpers['extends']({},this.$MercurySyncHolesTypedLogger1,j);return this;};h.prototype.setDifference=function(j){this.$MercurySyncHolesTypedLogger1.difference=j;return this;};h.prototype.setSeqID=function(j){this.$MercurySyncHolesTypedLogger1.seq_id=j;return this;};h.prototype.setTopicType=function(j){this.$MercurySyncHolesTypedLogger1.topic_type=j;return this;};h.prototype.setVC=function(j){this.$MercurySyncHolesTypedLogger1.vc=j;return this;};var i={difference:true,seq_id:true,topic_type:true,vc:true};f.exports=h;}),null);
__d('MercurySyncDeltaHandler',['invariant','Arbiter','ChannelConstants','LogHistory','MercuryConfig','MessagingConfig','MercuryDelayedDispatcher','MercuryPayloadSource','MercurySyncConstants','MercurySyncDeltaHolder','MercurySyncDeltaTypes','MercurySyncDispatcher','MercurySyncForcedFetchHandler','MercurySyncHolesTypedLogger','MercuryServerPayloadPreprocessor','MercurySyncTopicType','MercurySingletonProvider'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('LogHistory').getInstance('mercury_sync_delta_handler'),j=c('MessagingConfig').syncFetchRetries||0;k.getForFBID=function(m){return l.getForFBID(m);};k.get=function(){return l.get();};function k(m){this.$MercurySyncDeltaHandler1=m;this.$MercurySyncDeltaHandler2=c('MercurySyncDispatcher').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler4=c('MercurySyncForcedFetchHandler').getForFBID(this.$MercurySyncDeltaHandler1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercurySyncDeltaHandler1);this.__delayedDispatcher=c('MercuryDelayedDispatcher').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler5=new (c('MercurySyncDeltaHolder'))();this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler7=[];this.$MercurySyncDeltaHandler3=0;this.$MercurySyncDeltaHandler10=0;i.debug('constructor',JSON.stringify({fbid:this.$MercurySyncDeltaHandler1}));c('Arbiter').subscribe('MercurySyncDeltaHandler/initSeqID',function(n,o){i.debug('initSeqID',JSON.stringify(o));var p=o&&o.seqID,q=o&&o.fbid;if(!q)return;if(q!==this.$MercurySyncDeltaHandler1)return;if(p){this.$MercurySyncDeltaHandler3=p;}else this.$MercurySyncDeltaHandler3=0;this.$MercurySyncDeltaHandler11();}.bind(this));}k.prototype.$MercurySyncDeltaHandler11=function(){i.debug('setUpSubscriptionsToRealTimeUpdates',JSON.stringify({fbid:this.$MercurySyncDeltaHandler1}));this.$MercurySyncDeltaHandler9=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('delta'),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o)if(o.toString()!==this.$MercurySyncDeltaHandler1)return;var p=n&&n.obj&&n.obj.delta,q=n&&n.obj&&n.obj.iseq;if(!p||!q)return;this.$MercurySyncDeltaHandler12(q,c('MercurySyncTopicType').DELTA);this.$MercurySyncDeltaHandler13(q,p);this.$MercurySyncDeltaHandler5.push(q,p);this.$MercurySyncDeltaHandler14();}.bind(this));this.$MercurySyncDeltaHandler8=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType(c('ChannelConstants').FAKE_DFF),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o&&o.toString()!==this.$MercurySyncDeltaHandler1)return;var p=n&&n.obj&&n.obj.delta;if(!p)return;this.$MercurySyncDeltaHandler7.push(p);this.$MercurySyncDeltaHandler14();}.bind(this));};k.prototype.$MercurySyncDeltaHandler14=function(){if(this.$MercurySyncDeltaHandler6)return;if(this.$MercurySyncDeltaHandler7.length>0){var m=this.$MercurySyncDeltaHandler7.shift();this.$MercurySyncDeltaHandler15(this.$MercurySyncDeltaHandler3,m);this.$MercurySyncDeltaHandler14();}var n=this.$MercurySyncDeltaHandler5.peek();if(!n)return;var o=n-this.$MercurySyncDeltaHandler3;if(o===1){var p=this.$MercurySyncDeltaHandler5.pop();if(!p)return;var q=p.seqID,r=p.delta;this.$MercurySyncDeltaHandler15(q,r);this.$MercurySyncDeltaHandler14();}else if(o>1){this.$MercurySyncDeltaHandler16();}else{this.$MercurySyncDeltaHandler5.pop();this.$MercurySyncDeltaHandler14();}};k.prototype.$MercurySyncDeltaHandler15=function(m,n){this.$MercurySyncDeltaHandler3=m;if(n['class']===c('MercurySyncDeltaTypes').ForcedFetch){i.debug('DFF',JSON.stringify(n));if(n.threadKey!==undefined&&n.messageId===undefined){this.$MercurySyncDeltaHandler17(m,n);}else if(n.threadKey!==undefined&&n.messageId!==undefined){this.$MercurySyncDeltaHandler18(m,n);}else this.$MercurySyncDeltaHandler19(m);}else this.$MercurySyncDeltaHandler2.process(n);};k.prototype.$MercurySyncDeltaHandler16=function(){i.warn('hole',JSON.stringify({$MercurySyncDeltaHandler3:this.$MercurySyncDeltaHandler3,nextSeqID:this.$MercurySyncDeltaHandler5.peek()}));var m=this.$MercurySyncDeltaHandler5.peek();!!!m?h(0):void 0;var n=m-1;this.$MercurySyncDeltaHandler19(n);};k.prototype.$MercurySyncDeltaHandler20=function(m,n,o,p){!!this.$MercurySyncDeltaHandler6?h(0):void 0;this.$MercurySyncDeltaHandler6=true;i.debug('_scheduleDataFetch:start',JSON.stringify({seqID:m}));n().done(function(q){i.debug('_scheduleDataFetch:success',JSON.stringify({seqID:m}));o(m,q);this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler14();}.bind(this),function(){i.error('_scheduleDataFetch:failure',JSON.stringify({seqID:m}));p(m);this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler14();}.bind(this));};k.prototype.$MercurySyncDeltaHandler19=function(m){this.$MercurySyncDeltaHandler20(undefined,function(){return this.$MercurySyncDeltaHandler4.processGlobalDFF();}.bind(this),function(n,o){var p=o.getPayload();this.__payloadPreprocessor.handleUpdate(p);if(p.sequence_id){i.debug('_initiateGlobalDFF:success',JSON.stringify({seqID:p.sequence_id}));this.$MercurySyncDeltaHandler3=p.sequence_id;}this.$MercurySyncDeltaHandler10=0;c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE_RECOVER);}.bind(this),function(){i.error('_initiateGlobalDFF:failure','');if(this.$MercurySyncDeltaHandler10>=j){c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler9);c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler8);c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE);this.$MercurySyncDeltaHandler3=m;}else{this.$MercurySyncDeltaHandler10++;c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE_RETRY);i.debug('_initiateGlobalDFF:retry','');this.$MercurySyncDeltaHandler6=false;this.$MercurySyncDeltaHandler19(m);}}.bind(this));};k.prototype.$MercurySyncDeltaHandler17=function(m,n){this.$MercurySyncDeltaHandler20(m,function(){return this.$MercurySyncDeltaHandler4.processThreadDFF(m,n.threadKey,n.isLazy);}.bind(this),function(o,p){this.__payloadPreprocessor.handleUpdate(p.getPayload());this.$MercurySyncDeltaHandler3=o;}.bind(this),function(){i.error('_initiateThreadDFF:failure',JSON.stringify(n));var o=babelHelpers['extends']({},n);delete o.threadKey;this.$MercurySyncDeltaHandler3=m-1;this.$MercurySyncDeltaHandler5.push(m,o);}.bind(this));};k.prototype.$MercurySyncDeltaHandler18=function(m,n){this.$MercurySyncDeltaHandler20(m,function(){return this.$MercurySyncDeltaHandler4.processMessageDFF(m,n.threadKey,n.messageId,n.isLazy);}.bind(this),function(o,p){var q=p.getPayload(),r=q.other_user_fbid?q.other_user_fbid:q.thread_fbid,s=[babelHelpers['extends']({},q)],t=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:s,payload_source:t},r);this.$MercurySyncDeltaHandler3=o;}.bind(this),function(){i.error('_initiateMessageDFF:failure',JSON.stringify(n));var o=babelHelpers['extends']({},n);delete o.messageId;this.$MercurySyncDeltaHandler3=m-1;this.$MercurySyncDeltaHandler5.push(m,o);}.bind(this));};k.prototype.$MercurySyncDeltaHandler12=function(m,n){var o=m-this.$MercurySyncDeltaHandler3;if(o!==1&&o!==0){if(!c('MercuryConfig').WWWSyncHolesLogging)return;new (c('MercurySyncHolesTypedLogger'))().setSeqID(m).setDifference(o).setTopicType(n).log();}};k.prototype.$MercurySyncDeltaHandler13=function(m,n){switch(n['class']){case c('MercurySyncDeltaTypes').NewMessage:i.debug('message_delta',JSON.stringify({seqID:m,threadKey:n.messageMetadata.threadKey,messageId:n.messageMetadata.messageId}));break;case c('MercurySyncDeltaTypes').ReadReceipt:i.debug('read_receipt_delta',JSON.stringify({seqID:m,threadKey:n.threadKey,actionTimestampMs:n.actionTimestampMs,watermarkTimestampMs:n.watermarkTimestampMs}));break;case c('MercurySyncDeltaTypes').DeliveryReceipt:i.debug('delivery_receipt_delta',JSON.stringify({seqID:m,deliveredWatermarkTimestampMs:n.deliveredWatermarkTimestampMs,messageIds:n.messageIds}));break;}};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercurySyncEnvironment',['Arbiter','ChannelInitialData','CurrentUser','MercurySyncDeltaHandler'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){if(!c('ChannelInitialData').channelConfig)return;c('MercurySyncDeltaHandler').get();c('Arbiter').inform('MercurySyncDeltaHandler/initSeqID',{fbid:c('CurrentUser').getAccountID(),seqID:c('ChannelInitialData').channelConfig.sequenceId});}f.exports={setUp:h};}),null);
__d('MessengerFluxReduceDispatcher',['ExplicitRegistrationReactDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('ExplicitRegistrationReactDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('OmniMActions',['MessengerFluxReduceDispatcher','keyMirror','setImmediate'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({BAR_DISMISSED:null,BAR_DISPLAYED:null,BAR_DISAPPEARED:null,BAR_TIMED_OUT:null,MERCURY_DISPATCHED:null,FETCH_SUGGESTIONS:null,PREFS_UPDATED:null,SUGGESTION_CLICKED:null,SUGGESTION_COMPLETED:null,SUGGESTION_DISMISSED:null,SUGGESTION_DISPLAYED:null,SUGGESTION_DISAPPEARED:null,SUGGESTION_MODE_SET:null,SUGGESTIONS_DISMISSED_FOR_THREAD:null}),i='omnim',j={Types:h,Namespace:i,mercuryDispatched:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.MERCURY_DISPATCHED,namespace:i,mercuryType:l,data:m});},messageFetched:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.FETCH_SUGGESTIONS,namespace:i,threadID:l,message:m});});},suggestionClicked:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_CLICKED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionCompleted:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_COMPLETED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionDismissed:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISMISSED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionsDismissedForThread:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTIONS_DISMISSED_FOR_THREAD,namespace:i,threadID:l});},suggestionDisplayed:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISPLAYED,namespace:i,option:l,position:m});});},suggestionDisappeared:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISAPPEARED,namespace:i,option:l,position:m});});},prefsUpdated:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.PREFS_UPDATED,namespace:i,prefs:l});},suggestionModeSet:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_MODE_SET,namespace:i,mode:l});},barDismissed:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISMISSED,namespace:i,options:l});},barDisplayed:function k(l){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISPLAYED,namespace:i,options:l});});},barDisappeared:function k(l){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISAPPEARED,namespace:i,options:l});});},barTimedOut:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_TIMED_OUT,namespace:i,options:m,threadID:l});});}};f.exports=j;}),null);
__d('OmniMHelpers',['immutable','MercuryConfig'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){if(!c('MercuryConfig').OmniMEditConfidenceThreshold)return 0;if(i&&i.has('suggestion_mode')){var j=i.get('suggestion_mode');return j!==null&&j!==undefined?j:1;}return 3;}f.exports={suggestionMode:h};}),null);
__d('MNOmniMConstants',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('keyMirror')({OMNIM:null,QUICKREPLIES:null});h.SUGGESTION_MODES=['conservative','balanced','aggressive','muted'];f.exports=h;}),null);
__d('OmniMEventTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:OmniMEventLoggerConfig',this.$OmniMEventTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:OmniMEventLoggerConfig',this.$OmniMEventTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$OmniMEventTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$OmniMEventTypedLogger1=babelHelpers['extends']({},this.$OmniMEventTypedLogger1,j);return this;};h.prototype.setActionID=function(j){this.$OmniMEventTypedLogger1.action_id=j;return this;};h.prototype.setAgentName=function(j){this.$OmniMEventTypedLogger1.agent_name=j;return this;};h.prototype.setAppID=function(j){this.$OmniMEventTypedLogger1.appid=j;return this;};h.prototype.setAppversion=function(j){this.$OmniMEventTypedLogger1.appversion=j;return this;};h.prototype.setClientUserID=function(j){this.$OmniMEventTypedLogger1.client_userid=j;return this;};h.prototype.setConfidence=function(j){this.$OmniMEventTypedLogger1.confidence=j;return this;};h.prototype.setContextUserID=function(j){this.$OmniMEventTypedLogger1.context_user_id=j;return this;};h.prototype.setCuApp=function(j){this.$OmniMEventTypedLogger1.cu_app=j;return this;};h.prototype.setEventName=function(j){this.$OmniMEventTypedLogger1.event_name=j;return this;};h.prototype.setIntentID=function(j){this.$OmniMEventTypedLogger1.intent_id=j;return this;};h.prototype.setMessageID=function(j){this.$OmniMEventTypedLogger1.message_id=j;return this;};h.prototype.setMessageLength=function(j){this.$OmniMEventTypedLogger1.message_length=j;return this;};h.prototype.setName=function(j){this.$OmniMEventTypedLogger1.name=j;return this;};h.prototype.setPigeonID=function(j){this.$OmniMEventTypedLogger1.pigeon_id=j;return this;};h.prototype.setPosition=function(j){this.$OmniMEventTypedLogger1.position=j;return this;};h.prototype.setSuggestionData=function(j){this.$OmniMEventTypedLogger1.suggestion_data=c('GeneratedLoggerUtils').serializeMap(j);return this;};h.prototype.setSuggestionIds=function(j){this.$OmniMEventTypedLogger1.suggestion_ids=c('GeneratedLoggerUtils').serializeVector(j);return this;};h.prototype.setSuggestionMode=function(j){this.$OmniMEventTypedLogger1.suggestion_mode=j;return this;};h.prototype.setSuggestionTitle=function(j){this.$OmniMEventTypedLogger1.suggestion_title=j;return this;};h.prototype.setSuggestionType=function(j){this.$OmniMEventTypedLogger1.suggestion_type=j;return this;};h.prototype.setThreadKey=function(j){this.$OmniMEventTypedLogger1.thread_key=j;return this;};h.prototype.setTotalSuggestions=function(j){this.$OmniMEventTypedLogger1.total_suggestions=j;return this;};h.prototype.setVC=function(j){this.$OmniMEventTypedLogger1.vc=j;return this;};var i={action_id:true,agent_name:true,appid:true,appversion:true,client_userid:true,confidence:true,context_user_id:true,cu_app:true,event_name:true,intent_id:true,message_id:true,message_length:true,name:true,pigeon_id:true,position:true,suggestion_data:true,suggestion_ids:true,suggestion_mode:true,suggestion_title:true,suggestion_type:true,thread_key:true,total_suggestions:true,vc:true};f.exports=h;}),null);
__d('OmniMLogHelpers',['OmniMEventTypedLogger','MNOmniMConstants','OmniMLoggerEvents','CurrentUser'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(s){return c('MNOmniMConstants').SUGGESTION_MODES[s];}function i(s,t,u,v){new (c('OmniMEventTypedLogger'))().setEventName(s).setPosition(u+'').setMessageID(t.messageID).setPigeonID(t.suggestionID).setSuggestionMode(h(v)).setContextUserID(c('CurrentUser').getID()).setConfidence(Math.round(t.confidence*10000)).log();}function j(s,t,u){new (c('OmniMEventTypedLogger'))().setEventName(s).setSuggestionMode(h(u)).setContextUserID(c('CurrentUser').getID()).setSuggestionIds(t.map(function(v){return v.suggestionID;})).log();}function k(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISPLAYED,s,t,u);}function l(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISAPPEARED,s,t,u);}function m(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISMISSED,s,t,u);}function n(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_CLICKED,s,t,u);}function o(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_COMPLETED,s,t,u);}function p(s,t){j(c('OmniMLoggerEvents').BAR_DISAPPEARED,s,t);}function q(s,t){j(c('OmniMLoggerEvents').BAR_DISMISSED,s,t);}function r(s,t){j(c('OmniMLoggerEvents').BAR_DISPLAYED,s,t);}f.exports={barDisappeared:p,barDisplayed:r,barDismissed:q,suggestionDisplayed:k,suggestionDisappeared:l,suggestionDismissed:m,suggestionClicked:n,suggestionCompleted:o};}),null);
__d("XMessagingOmniMSetPrefController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/set_omnim_prefs\/",{});}),null);
__d('OmniMReducer',['AsyncRequest','immutable','MercuryActionType','MercuryConfig','MercuryIDs','MercuryPayloadSource','MNOmniMConstants','OmniMActions','OmniMActionType','OmniMDirectiveType','OmniMLogHelpers','P2PGKValues','XMessagingOmniMSetPrefController'],(function a(b,c,d,e,f,g){'use strict';var h;if(c.__markCompiled)c.__markCompiled();var i=c('OmniMActions').Types,j=c('immutable').Set([c('MercuryActionType').SEND_MESSAGE,c('MercuryActionType').REPLACE_MESSAGE,c('MercuryActionType').USER_GENERATED_MESSAGE]),k=c('immutable').Set([c('MercuryActionType').SEND_MESSAGE,c('MercuryActionType').USER_GENERATED_MESSAGE]),l=2;function m(oa,pa){switch(oa.content_type){case 'text':return true;case 'location':if(pa===c('MNOmniMConstants').OMNIM)return c('MercuryConfig').OmniMLocationSuggestion;return c('MercuryConfig').MessengerLocationQuickReply;case 'sticker':return c('MercuryConfig').MessengerStickerQuickReply;case 'ride_service':return c('MercuryConfig').MessengerRideServiceQuickReply;case 'p2p_payment':return c('P2PGKValues').P2PVisible&&c('MercuryConfig').MessengerP2PPaymentQuickReply;default:return false;}}function n(oa){return Array.isArray(oa);}function o(oa){if(!oa)return {};var pa=JSON.parse(oa)||{},qa=n(pa.quick_replies)?pa.quick_replies:[],ra=pa.m_directives;return {quickReplies:qa,directives:ra};}function p(oa){var pa=oa.other_user_fbid,qa=oa.thread_fbid;return pa?c('MercuryIDs').getThreadIDFromUserID(pa):c('MercuryIDs').getThreadIDFromThreadFBID(qa);}var q=c('immutable').Map((h={},h[c('OmniMActionType').CREATE_EVENT]='create_event',h[c('OmniMActionType').LOCATION]='location',h[c('OmniMActionType').PAYMENT]='p2p_payment',h[c('OmniMActionType').POLL]='poll',h[c('OmniMActionType').STICKER]='sticker',h[c('OmniMActionType').TEXT]='text',h[c('OmniMActionType').TRANSPORTATION]='ride_service',h[c('OmniMActionType').ORDER_FOOD]='order_food',h[c('OmniMActionType').MAKE_RESERVATION]='make_reservation',h[c('OmniMActionType').SCHEDULE_CALL]='schedule_call',h[c('OmniMActionType').LIVE_LOCATION]='live_location',h));function r(oa){var pa=oa.confidence,qa=oa.id,ra=oa.label,sa=oa.type,ta=oa.data,ua=oa.icon,va=oa.message_id,wa=oa.thread_key;return {content_type:q.get(sa+''),data:ta,image_url:ua,title:ra,confidence:pa,messageID:va,suggestionID:qa,threadID:p(wa),messageDepth:1};}function s(oa,pa){var qa=o(pa),ra=(qa.quickReplies||[]).filter(function(ta){return m(ta,c('MNOmniMConstants').QUICKREPLIES);}),sa=(qa.directives||[]).filter(function(ta){return ta.type===c('OmniMDirectiveType').ADD_ACTIONS;}).map(function(ta){return ta.data.actions;}).reduce(function(ta,ua){return ta.concat(ua);},[]).map(r).filter(function(ta){return m(ta,c('MNOmniMConstants').OMNIM);}).reduce(function(ta,ua){var va=ua.threadID;return ta.updateIn([va,'agentSuggestions'],[],function(wa){return wa.concat([ua]);});},c('immutable').Map({}));return sa.setIn([oa,'quickReplies'],ra);}function t(oa){var pa=oa.content_type;Object.keys(oa.data||{}).sort().map(function(qa){pa+=''+qa+oa.data[qa];});return pa;}function u(oa){var pa=c('immutable').Set(),qa=[];for(var ra=oa.length-1;ra>=0;ra--){var sa=oa[ra],ta=t(sa);if(!pa.has(ta)){pa=pa.add(ta);qa.unshift(sa);}}return qa;}function v(oa){var pa=0;return oa.filter(function(qa){if(qa.content_type==='sticker'){if(pa>=l)return false;pa+=1;}return true;});}function w(oa,pa,qa,ra){var sa=oa.getIn(['threadMetadata',pa,'timestamp']);if(sa&&sa>ra)return oa;var ta=qa.agentSuggestions,ua=qa.quickReplies,va=(oa.getIn(['suggestionsByThread',pa])||{}).agentSuggestions||[],wa=ta||[];if(va.length)wa=v(wa);var xa=u(wa.concat(va));return oa.setIn(['threadMetadata',pa,'timestamp'],ra).setIn(['suggestionsByThread',pa],{agentSuggestions:xa,quickReplies:ua});}function x(oa,pa,qa,ra,sa){var ta=s(pa,ra);return ta.reduce(function(ua,va,wa){return w(ua,wa,va.toJS(),sa);},oa);}function y(oa){if(!oa)return null;var pa=oa.agentSuggestions,qa=(pa||[]).reduce(function(ra,sa){if(sa.messageDepth>=c('MercuryConfig').OmniMMessagesToLive)return ra;return ra.concat([babelHelpers['extends']({},sa,{messageDepth:sa.messageDepth+1})]);},[]);return babelHelpers['extends']({},oa,{agentSuggestions:qa});}function z(oa,pa){var qa=pa.thread_id,ra=pa.message_id,sa=pa.platform_xmd,ta=pa.timestamp;if(k.has(pa.action_type))oa=oa.updateIn(['suggestionsByThread',qa],y);return x(oa,qa,ra,sa,ta);}function aa(oa,pa){if(pa.type!==i.MERCURY_DISPATCHED)return oa;var qa=pa.data;switch(pa.mercuryType){case 'update-messages':if(qa.payload_source!==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)return oa;return qa.actions.filter(function(ra){return j.has(ra.action_type);}).reduce(z,oa);case 'invalidate-thread-state':return oa.deleteIn(['suggestionsByThread',qa.threadID]).deleteIn(['threadMetadata',qa.threadID]);case 'invalidate-global-state':return oa.set('suggestionsByThread',c('immutable').Map()).set('threadMetadata',c('immutable').Map());}return oa;}function ba(oa,pa){if(pa.type!==i.FETCH_SUGGESTIONS)return oa;var qa=pa.message,ra=pa.threadID;return x(oa,ra,qa.message_id,qa.platform_xmd,qa.timestamp);}function ca(oa){return oa.getIn(['prefs','suggestion_mode'],0);}function da(oa,pa){if(pa.type!==i.SUGGESTION_CLICKED)return oa;var qa=pa.option,ra=pa.position,sa=pa.source;if(sa===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionClicked(qa,ra,ca(oa));return oa;}function ea(oa,pa){if(pa.type!==i.SUGGESTION_COMPLETED)return oa;var qa=pa.threadID,ra=pa.option,sa=pa.position,ta=pa.source;if(ta===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionCompleted(ra,sa,ca(oa));return oa.deleteIn(['suggestionsByThread',qa]);}function fa(oa,pa){if(pa.type!==i.SUGGESTION_DISMISSED)return oa;var qa=pa.threadID,ra=pa.option,sa=pa.source,ta=pa.position;if(sa===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionDismissed(ra,ta,ca(oa));var ua=oa.getIn(['suggestionsByThread',qa]);if(!ua||!ua.agentSuggestions)return oa;var va=ua.agentSuggestions.map(function(wa){if(wa.suggestionID===ra.suggestionID)return babelHelpers['extends']({},wa,{dismissed:true});return wa;});return oa.setIn(['suggestionsByThread',qa],babelHelpers['extends']({},ua,{agentSuggestions:va}));}function ga(oa,pa){if(pa.type!==i.SUGGESTIONS_DISMISSED_FOR_THREAD)return oa;var qa=pa.threadID,ra=oa.getIn(['suggestionsByThread',qa]);if(!ra||!ra.agentSuggestions)return oa;c('OmniMLogHelpers').barDismissed(ra.agentSuggestions,ca(oa));var sa=ra.agentSuggestions.map(function(ta,ua){if(ta.dismissed)return ta;c('OmniMLogHelpers').suggestionDismissed(ta,ua,ca(oa));return babelHelpers['extends']({},ta,{dismissed:true});});return oa.setIn(['suggestionsByThread',qa],babelHelpers['extends']({},ra,{agentSuggestions:sa}));}function ha(oa,pa){if(pa.type!==i.PREFS_UPDATED)return oa;var qa=pa.prefs;return oa.updateIn(['prefs'],function(ra){return ra.merge(c('immutable').fromJS(qa));});}function ia(oa,pa){if(pa.type!==i.SUGGESTION_MODE_SET)return oa;var qa=pa.mode,ra=c('XMessagingOmniMSetPrefController').getURIBuilder().getURI();new (c('AsyncRequest'))(ra).setMethod('POST').setData({suggestion_mode:qa}).send();return oa.setIn(['prefs','suggestion_mode'],qa);}function ja(oa,pa){if(pa.type!==i.SUGGESTION_DISPLAYED)return oa;var qa=pa.option,ra=pa.position;if(!qa.dismissed)c('OmniMLogHelpers').suggestionDisplayed(qa,ra,ca(oa));return oa;}function ka(oa,pa){if(pa.type!==i.SUGGESTION_DISAPPEARED)return oa;var qa=pa.option,ra=pa.position;if(!qa.dismissed)c('OmniMLogHelpers').suggestionDisappeared(qa,ra,ca(oa));return oa;}function la(oa,pa){if(pa.type!==i.BAR_TIMED_OUT)return oa;var qa=pa.threadID,ra=pa.options;c('OmniMLogHelpers').barDisappeared(ra,ca(oa));return oa.deleteIn(['suggestionsByThread',qa]);}function ma(oa,pa){if(pa.type!==i.BAR_DISAPPEARED)return oa;c('OmniMLogHelpers').barDisappeared(pa.options,ca(oa));return oa;}function na(oa,pa){if(pa.type!==i.BAR_DISPLAYED)return oa;c('OmniMLogHelpers').barDisplayed(pa.options,ca(oa));return oa;}f.exports={barDisappeared:ma,barDisplayed:na,barTimedOut:la,mercuryDispatch:aa,messageFetched:ba,prefsUpdated:ha,suggestionClicked:da,suggestionCompleted:ea,suggestionDisappeared:ka,suggestionDismissed:fa,suggestionDisplayed:ja,suggestionModeSet:ia,suggestionsDismissedForThread:ga};}),null);
__d('OmniMState',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j={suggestionsByThread:c('immutable').Map(),threadMetadata:c('immutable').Map(),prefs:c('immutable').Map()};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d("XMessagingOmniMPrefController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/get_omnim_prefs\/",{});}),null);
__d('OmniMStore',['AsyncRequest','FluxReduceStore','immutable','MercuryConfig','MercuryDispatcher','MercuryMessages','MessengerFluxReduceDispatcher','OmniMHelpers','OmniMReducer','OmniMState','OmniMActions','XMessagingOmniMPrefController'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=5,k=[].concat(Object.values(c('OmniMReducer')));h=babelHelpers.inherits(l,c('FluxReduceStore'));i=h&&h.prototype;l.prototype.getInitialState=function(){return new (c('OmniMState'))();};l.prototype.reduce=function(m,n){if(n.namespace!==c('OmniMActions').Namespace)return m;return k.reduce(function(o,p){return p(o,n);},m);};l.prototype.$OmniMStore1=function(m){c('MercuryMessages').get().getThreadMessagesRange(m,0,1,function(n){if(n&&n.length){var o=n[0];c('OmniMActions').messageFetched(m,o);}});};l.prototype.$OmniMStore2=function(){var m=this.getState().get('prefs'),n=c('OmniMHelpers').suggestionMode(m),o=c('MercuryConfig').OmniMConfidenceThresholds[n];return o||.9;};l.prototype.$OmniMStore3=function(m){var n=this.$OmniMStore2();return (m||[]).filter(function(o){return o.confidence&&o.confidence>n;});};l.prototype.suggestionsForThread=function(m){var n=this.getState();if(!n.getIn(['threadMetadata',m]))this.$OmniMStore1(m);var o=n.getIn(['suggestionsByThread',m],{}),p=this.$OmniMStore3(o.agentSuggestions).slice(0,j);return babelHelpers['extends']({},o,{agentSuggestions:p});};l.prototype.prefs=function(){return this.getState().get('prefs');};l.prototype.$OmniMStore4=function(){var m=c('MercuryDispatcher').get();m.subscribe('update-messages',function(n,o){c('OmniMActions').mercuryDispatched(n,o);});m.subscribe('invalidate-thread-state',function(n,o){c('OmniMActions').mercuryDispatched(n,{threadID:o});});m.subscribe('invalidate-global-state',function(n){return c('OmniMActions').mercuryDispatched(n);});};l.prototype.$OmniMStore5=function(){if(c('MercuryConfig').OmniMEditConfidenceThreshold){var m=c('XMessagingOmniMPrefController').getURIBuilder().getURI();new (c('AsyncRequest'))(m).setAllowCrossPageTransition(true).setReadOnly(true).setMethod('POST').setHandler(function(n){return c('OmniMActions').prefsUpdated(n.payload);}).send();}};l.prototype.setUp=function(){this.$OmniMStore4();this.$OmniMStore5();};function l(){h.apply(this,arguments);}f.exports=new l(c('MessengerFluxReduceDispatcher'));}),null);
__d('DockTabsViewportChatTabUtils',['isInFocusMode'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=175,i=269;function j(){return h;}function k(){return i;}function l(t){return t.raised?k():j();}function m(t){if(!t)return null;var u=t.chatTabModelStateGetter;return u?u():null;}function n(t){return (t&&t.tabs?t.tabs.length:0);}function o(t){var u=t.tabs;if(u){return JSON.parse(JSON.stringify(u));}else return [];}function p(t,u,v){var w={};u=Math.min(u,t.length);for(var x=0;x<u;x++){var y=t[x],z=y.tab,aa=y.alreadyPlacedPromoted;if(c('isInFocusMode')(z.id))continue;if(!aa&&x==u-1&&v){w[v]=true;}else w[z.id]=true;}return w;}function q(t,u,v){var w=v.promotedIndex,x=v.promotedTab,y=0,z=false,aa=0,ba=!x,ca=[];t.forEach(function(da,ea){var fa=!z?k():l(da);z=z||!da.raised;var ga=y+fa;y+=fa;if(ga<u)aa++;ba=ba||ea==w;var ha={tab:da,leftmostOffset:ga,alreadyPlacedPromoted:ba};ca.push(ha);});return {annotatedTabs:ca,numShowingTabs:aa};}function r(){return k()+1;}function s(t,u){u=Math.max(u,r());var v=o(t),w=t.promoted,x=-1,y=null;if(w)v.forEach(function(ja,ka){if(ja.id===w){x=ka;y=ja;}});var z=q(v,u,{promotedIndex:x,promotedTab:y}),aa=z.annotatedTabs,ba=z.numShowingTabs,ca=p(aa,ba,w),da=p(aa,ba-1,w),ea=null;for(var fa in ca)if(!da[fa])ea=fa;var ga=aa[ba-1],ha=ga?ga.leftmostOffset:0,ia=Infinity;if(ba<aa.length)ia=aa[ba].leftmostOffset;return {nextToHide:ea,tabsToShow:ca,usedWidth:ha,widthToShowNext:ia};}f.exports={getLoweredChatTabWidth:j,getRaisedChatTabWidth:k,getChatTabWidth:l,getChatTabModelFromCallbacks:m,getNumChatTabsFromModel:n,getMinRequiredWidthForFirstChatTab:r,getChatTabsViewState:s};}),null);
__d('DockTabsViewportFantaTabUtils',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=269;function i(){return h+1;}function j(m){return Math.floor(m/h);}function k(m){if(!m)return null;var n=m.fantaTabModelStateGetter;return n?n():null;}function l(m){return m?m.size:0;}f.exports={getTabCountToFitWidth:j,getMinRequiredWidthForFirstFantaTab:i,getFantaTabModelFromCallbacks:k,getNumFantaTabsFromModel:l};}),null);
__d('DockTabsViewportPinnedConversationTabUtils',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=496+9+2,i=210+9+2,j=52;function k(){return h;}function l(){return i;}function m(){return j;}function n(r){return (r.getIsRaised()?k():l());}function o(){return (k()+j);}function p(r){var s=r||{},t=s.pinnedConvoTabStateGetter;return t?t():null;}function q(r){return (r?r.getTotalTabCount():0);}f.exports={getRaisedPinnedConvoTabWidth:k,getLoweredPinnedConvoTabWidth:l,getPinnedConvoSelectorWidth:m,getPinnedConvoTabWidth:n,getMinRequiredWidthForFirstConvoTab:o,getPinnedConvoTabsStateFromCallbacks:p,getNumPinnedConvoTabsFromModel:q};}),null);
__d('DockTabsViewportCalculator',['csx','Arbiter','DataStore','Dock','DockTabsViewportCalculatorConfig','DockTabsViewportChatTabUtils','DockTabsViewportFantaTabUtils','DockTabsViewportPinnedConversationTabUtils','DOM','Event','FullScreen','Parent','SubscriptionsHandler','Vector','ViewportBounds','getViewportDimensions','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('DockTabsViewportCalculatorConfig').FantaTabs,j=50,k=15,l=35,m=i?l:k,n='dock-tab-viewport-inst',o=c('DockTabsViewportChatTabUtils').getChatTabModelFromCallbacks,p=c('DockTabsViewportChatTabUtils').getNumChatTabsFromModel,q=c('DockTabsViewportChatTabUtils').getMinRequiredWidthForFirstChatTab,r=c('DockTabsViewportFantaTabUtils').getMinRequiredWidthForFirstFantaTab,s=c('DockTabsViewportFantaTabUtils').getFantaTabModelFromCallbacks,t=c('DockTabsViewportFantaTabUtils').getNumFantaTabsFromModel,u=c('DockTabsViewportPinnedConversationTabUtils').getMinRequiredWidthForFirstConvoTab,v=c('DockTabsViewportPinnedConversationTabUtils').getNumPinnedConvoTabsFromModel,w=c('DockTabsViewportPinnedConversationTabUtils').getPinnedConvoSelectorWidth,x=c('DockTabsViewportPinnedConversationTabUtils').getPinnedConvoTabsStateFromCallbacks;function y(z){this.$DockTabsViewportCalculatorImpl1=z;this.$DockTabsViewportCalculatorImpl3=0;this.$DockTabsViewportCalculatorImpl4=0;this.$DockTabsViewportCalculatorImpl5=null;this.$DockTabsViewportCalculatorImpl6=null;this.$DockTabsViewportCalculatorImpl7=null;this.$DockTabsViewportCalculatorImpl8=false;this.$DockTabsViewportCalculatorImpl9=false;this.$DockTabsViewportCalculatorImpl10=false;this.$DockTabsViewportCalculatorImpl2=new (c('SubscriptionsHandler'))();this.$DockTabsViewportCalculatorImpl11();this.$DockTabsViewportCalculatorImpl12();}y.prototype.$DockTabsViewportCalculatorImpl11=function(){var z=this.$DockTabsViewportCalculatorImpl13.bind(this);this.$DockTabsViewportCalculatorImpl2.addSubscriptions(c('Event').listen(window,'resize',z),c('Dock').subscribe('resize',z),c('Arbiter').subscribeOnce('sidebar/initialized',z,c('Arbiter').SUBSCRIBE_NEW),c('FullScreen').subscribe('changed',function(){if(c('FullScreen').isFullScreen()){this.$DockTabsViewportCalculatorImpl8=true;this.$DockTabsViewportCalculatorImpl9=false;}else{this.$DockTabsViewportCalculatorImpl8=false;if(this.$DockTabsViewportCalculatorImpl9){c('setImmediate')(function(){z();});this.$DockTabsViewportCalculatorImpl9=false;}}}.bind(this)));};y.prototype.registerFantaTabCallbacks=function(z){if(!i)return;this.$DockTabsViewportCalculatorImpl6=z;};y.prototype.registerChatTabCallbacks=function(z){if(i)return;this.$DockTabsViewportCalculatorImpl5=z;};y.prototype.registerPinnedConvoTabCallbacks=function(z){this.$DockTabsViewportCalculatorImpl7=z;};y.prototype.forceRecalculateFBDockWidth=function(){this.$DockTabsViewportCalculatorImpl12();this.$DockTabsViewportCalculatorImpl14({forceRecalculateChatTabs:false,pinnedConvoUpdateData:null});};y.prototype.forceRecalculateChatTabs=function(){this.$DockTabsViewportCalculatorImpl14({forceRecalculateChatTabs:true,pinnedConvoUpdateData:null});};y.prototype.forceRecalculatePinnedConvoTabs=function(z){this.$DockTabsViewportCalculatorImpl14({forceRecalculateChatTabs:true,pinnedConvoUpdateData:z});};y.prototype.$DockTabsViewportCalculatorImpl13=function(){if(c('FullScreen').isFullScreen()||this.$DockTabsViewportCalculatorImpl8){this.$DockTabsViewportCalculatorImpl9=true;return;}this.forceRecalculateFBDockWidth();};y.prototype.$DockTabsViewportCalculatorImpl14=function(z){var aa=z.forceRecalculateChatTabs,ba=z.pinnedConvoUpdateData,ca=this.$DockTabsViewportCalculatorImpl15(),da=ca.chatTabAvailableWidth,ea=ca.pinnedConvoTabAvailableWidth;this.$DockTabsViewportCalculatorImpl16(da,!!aa);this.$DockTabsViewportCalculatorImpl17(ea,ba);};y.prototype.$DockTabsViewportCalculatorImpl17=function(z,aa){var ba=this.$DockTabsViewportCalculatorImpl7||{},ca=ba.onAvailableWidthChanged;ca&&ca(z,aa);};y.prototype.$DockTabsViewportCalculatorImpl16=function(z,aa){if(i){var ba=this.$DockTabsViewportCalculatorImpl6||{},ca=ba.onAvailableWidthChanged;ca&&ca(z);}else{var da=this.$DockTabsViewportCalculatorImpl5||{},ea=da.onAvailableWidthChanged,fa=da.onAvailableWidthChangedWithForcedTabRecalc;if(aa){fa&&fa(z);}else ea&&ea(z);}};y.prototype.$DockTabsViewportCalculatorImpl18=function(){if(i){var z=s(this.$DockTabsViewportCalculatorImpl6);return t(z);}else{var aa=o(this.$DockTabsViewportCalculatorImpl5);return p(aa);}};y.prototype.$DockTabsViewportCalculatorImpl19=function(){if(i){return r();}else return q();};y.prototype.$DockTabsViewportCalculatorImpl15=function(){var z=this.$DockTabsViewportCalculatorImpl3,aa={chatTabAvailableWidth:z,pinnedConvoTabAvailableWidth:0},ba={chatTabAvailableWidth:0,pinnedConvoTabAvailableWidth:z},ca=this.$DockTabsViewportCalculatorImpl18(),da=x(this.$DockTabsViewportCalculatorImpl7),ea=v(da);if(!da||ea===0){return aa;}else if(ca===0)return ba;var fa=this.$DockTabsViewportCalculatorImpl19();if(z<=fa)return aa;var ga=w(),ha=u(),ia=z-fa,ja=0;if(ia<ha){return aa;}else ja=ha;var ka=ja,la=Math.max(fa,z-ja);return {chatTabAvailableWidth:la,pinnedConvoTabAvailableWidth:ka};};y.prototype.$DockTabsViewportCalculatorImpl12=function(){this.$DockTabsViewportCalculatorImpl3=this.$DockTabsViewportCalculatorImpl20();this.$DockTabsViewportCalculatorImpl21('DockTabsViewportCalculator/recalcTotalDock_FOR_TEST_ONLY');};y.prototype.$DockTabsViewportCalculatorImpl20=function(){var z=c('getViewportDimensions').withoutScrollbars().width;z-=c('ViewportBounds').getLeft()+c('ViewportBounds').getRight();z-=j;var aa=this.$DockTabsViewportCalculatorImpl1,ba=c('DOM').find(aa,"._56ox"),ca=ba?c('Vector').getElementDimensions(ba).x:0;z-=ca;var da=c('DOM').scry(aa,"._56oy");ca+=c('Vector').getElementDimensions(da.pop()).x;var ea=c('DOM').scry(aa,"._ph1")[0],fa=ea?c('Vector').getElementDimensions(ea).x:0,ga=c('Vector').getElementDimensions(aa),ha=ga.x-ca-fa;if(ha>this.$DockTabsViewportCalculatorImpl4)this.$DockTabsViewportCalculatorImpl4=ha;z-=this.$DockTabsViewportCalculatorImpl4;z-=m;return Math.max(z,0);};y.prototype.enableTestInforms_FOR_TEST_ONLY=function(){this.$DockTabsViewportCalculatorImpl10=true;};y.prototype.$DockTabsViewportCalculatorImpl21=function(z){if(this.$DockTabsViewportCalculatorImpl10)c('Arbiter').inform(z);};y.prototype.getChatTabAvailableDockWidth_FOR_TEST_ONLY=function(){return this.$DockTabsViewportCalculatorImpl15().chatTabAvailableWidth;};y.prototype.getPinnedConvoTabAvailableDockWidth_FOR_TEST_ONLY=function(){return this.$DockTabsViewportCalculatorImpl15().pinnedConvoTabAvailableWidth;};y.prototype.getAvailableTotalWidth_FOR_TEST_ONLY=function(){return this.$DockTabsViewportCalculatorImpl3;};f.exports={getInstance:function z(aa){var ba=c('Parent').byClass(aa,'fbDock');if(!ba)return null;var ca=c('DataStore').get(ba,n);if(ca instanceof y)return ca;ca=new y(ba);c('DataStore').set(ba,n,ca);return ca;}};}),null);
__d('TabsViewport',['Arbiter','ArbiterMixin','ChatTabModel','DockTabsViewportCalculator','DockTabsViewportChatTabUtils','areJSONRepresentationsEqual'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('DockTabsViewportChatTabUtils').getLoweredChatTabWidth,i=c('DockTabsViewportChatTabUtils').getRaisedChatTabWidth,j=c('DockTabsViewportChatTabUtils').getChatTabsViewState;function k(){return c('ChatTabModel').get();}function l(m){this._root=m;this._dockCalculator=c('DockTabsViewportCalculator').getInstance(m);this._dockCalculator&&this._dockCalculator.registerChatTabCallbacks({chatTabModelStateGetter:function n(){return k();},onAvailableWidthChanged:function(n){this._onAvailableWidthChanged(n);}.bind(this),onAvailableWidthChangedWithForcedTabRecalc:function(n){this._onAvailableWidthChangedWithForcedTabRecalc(n);}.bind(this)});c('ChatTabModel').addListener(function(){this._dockCalculator&&this._dockCalculator.forceRecalculateChatTabs();}.bind(this));this._forceRecalculateDockWidth();this._initialized=true;}Object.assign(l.prototype,c('ArbiterMixin'),{_root:null,_initialized:false,_dockCalculator:null,_availableWidth:0,_maxShown:1,_viewState:null,_onAvailableWidthChanged:function m(n){this._onAvailableWidthChangedImpl(n,false);},_onAvailableWidthChangedWithForcedTabRecalc:function m(n){this._onAvailableWidthChangedImpl(n,true);},_onAvailableWidthChangedImpl:function m(n,o){var p=Math.max(1,Math.floor(n/i())),q=p!=this._maxShown;if(!this._viewState||q||n<=this._viewState.usedWidth||n>this._viewState.widthToShowNext||o){this._availableWidth=n;this._maxShown=p;this._viewState=null;this._recalculateTabsViewState(q||o);}},_onTabsChanged:function m(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabsViewState:function m(n){var o=l._getTabsToShow(k(),this._availableWidth);if(n||!c('areJSONRepresentationsEqual')(this._viewState,o)){this._viewState=o;this._onTabsChanged();}},getMaxTabsToShow:function m(){return this._maxShown;},_forceRecalculateDockWidth:function m(){this._dockCalculator&&this._dockCalculator.forceRecalculateFBDockWidth();},checkWidth:function m(){this._forceRecalculateDockWidth();},hasRoomForRaisedTab:function m(){return (this._availableWidth-this._viewState.usedWidth>i());},getTabsToShow:function m(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function m(){var n=k(),o=this._viewState.tabsToShow;return n.tabs.filter(function(p){return o[p.id];});},getRightmostHiddenTab:function m(){var n=k(),o=this._viewState.tabsToShow,p=n.tabs.filter(function(r){return !o[r.id];}),q=p.shift();return q?q.id:null;},getLeftmostVisibleTab:function m(){var n=this.getShowingTabsOrder(),o=n.pop();return o?o.id:null;},getRaisedVisibleTabs:function m(){var n=[],o=this.getShowingTabsOrder(),p=o.length;for(var q=0;q<p;q++)if(c('ChatTabModel').getTab(o[q].id).raised)n.push(o[q].id);return n;},shouldPromoteOnRaise:function m(n){if(!this._viewState.tabsToShow[n])return true;if(this._viewState.nextToHide!=n)return false;var o=c('ChatTabModel').getTab(n),p=o&&o.raised;return !p&&this._availableWidth-this._viewState.usedWidth<i()-h();},getAvailableWidth_FOR_TEST_ONLY:function m(){if(this._dockCalculator)return this._dockCalculator.getChatTabAvailableDockWidth_FOR_TEST_ONLY();return 0;}});Object.assign(l,{_getTabsToShow:function m(n,o){return j(n,o);}});f.exports=l;}),null);
__d('ChatApp',['ChatAppActions','ChatAppStore','ChatPerfInstrumentation','CSS','JSLogger','TimeSlice'],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={chatOpenTabImpl:undefined,tabsViewport:undefined,tabViewCoordinator:undefined,tabController:undefined,init:function n(o,p,q){if(this.isInitialized()){c('JSLogger').create('chat_app').error('repeated_init');return;}this._rootElem=o;var r=c('ChatAppStore').addListener(function(){var s=c('ChatAppStore').getPreviousState(),t=c('ChatAppStore').getState();if(s.initialDisplayDone===false&&t.initialDisplayDone===true){m(this._rootElem);r.remove();}}.bind(this));c('ChatPerfInstrumentation').init();c('TimeSlice').guard(function(){return i();},'ChatApp stores',{isContinuation:true})();c('TimeSlice').guard(function(){return j(q);},'ChatApp data',{isContinuation:true})();c('TimeSlice').guard(function(){return k(p,o);},'ChatApp UI',{isContinuation:true})();c('TimeSlice').guard(function(){return l();},'ChatApp Hotlike sound',{isContinuation:true})();c('TimeSlice').guard(function(){c('ChatAppActions').tti();c('ChatPerfInstrumentation').logTTI();},'ChatApp TTI',{isContinuation:true})();},isInitialized:function n(){return !!c('ChatAppStore').getState().isInitialized;},isHidden:function n(){var o=c('ChatAppStore').getState();return !!(!o.isInitialized||o.isHidden);},hide:function n(){if(this.isHidden())return;c('CSS').hide(this._rootElem);c('ChatAppActions').hide();},unhide:function n(){var o=c('ChatAppStore').getState();if(o.isInitialized){if(o.isHidden){c('CSS').show(this._rootElem);this.tabsViewport&&this.tabsViewport.checkWidth();e(['Dock'],function(p){p.resizeAllFlyouts();});c('ChatAppActions').unhide();}}else if(!o.isLoaded){e(['UIPagelet'],function(p){p.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');p.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});c('ChatAppActions').load();}}};function i(){e(['MercuryBlockedParticipants','MercuryChannelHandlerDEPRECATED','MercuryDelayedRoger','MercuryDeliveryReceipts','MercuryDeliveryState','MercuryParticipants','MercuryThreads','MercuryUnreadState','MercuryUnseenState','MercurySyncEnvironment','P2PSendMoneyDialogStore','OmniMStore'],function(n,o,p,q,r,s,t,u,v,w,x,y){n.get();o.get().turnOn();p.get();q.get();r.get();s;t.get();v.get();u.get();w.setUp();y.setUp();c('ChatPerfInstrumentation').logInitStores();});}function j(n){e(['MercuryServerPayloadPreprocessor'],function(o){o.get().handleUpdate(n);c('ChatPerfInstrumentation').logInitData();});}function k(n,o){e(['ChatDispatcher','ChatOpenTabImpl','ChatTabController','ChatTabModel','ChatTabViewCoordinator','FBRTCMessageHandler','MercuryBrowserAlerts','TabsViewport'],function(p,q,r,s,t,u,v,w){u.init();v.init();p.explicitlyRegisterStore(s);h.tabsViewport=new w(n);h.tabViewCoordinator=new t(n,h.tabsViewport);h.tabController=new r(h.tabsViewport);h.chatOpenTabImpl=q;c('ChatPerfInstrumentation').logInitUI();if(s.get().tabs.length===0)c('ChatPerfInstrumentation').logDisplayDone();});}function l(){e(['HotLikeSound','ChatOptions'],function(n,o){n.setCheckSoundEnabledFunc(function(){return o.getSetting('sound');});c('ChatPerfInstrumentation').logInitSound();});}function m(n){c('ChatPerfInstrumentation').logDisplayDone();}f.exports=h;}),null);
__d('DropdownContextualHelpLink',['DOM','ge'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={set:function i(j){var k=c('ge')('navHelpCenter');if(k!==null)c('DOM').replace(k,j);}};f.exports=h;}),null);